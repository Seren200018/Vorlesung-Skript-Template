import{a as Ae}from"./roughjs-GtHDBO_d.js";import"./vendor-iQCKx8iG.js";import{c as ie,i as Et,a as ne}from"./mathjs-XxrZN8d5.js";const n=ie(ne);class Te{constructor({x:t=0,y:e=0,width:s=100,height:i=100,fill:o="grey"}={}){this.x=t,this.y=e,this.width=s,this.height=i,this.fill=o}move(t,e){this.x+=t,this.y+=e}render(t,e,{shadow:s=!1,shadowOffset:i=10}={}){if(s){t.save(),t.globalAlpha=.5,t.fillStyle="rgba(0,0,0,1)",t.filter="blur(2.5px)",t.fillRect(this.x+i,this.y+i,this.width,this.height),t.restore();return}t.save(),t.globalAlpha=1,t.filter="none",t.fillStyle="rgb(255,255,255)",t.fillRect(this.x,this.y,this.width,this.height),e&&e.rectangle(this.x,this.y,this.width,this.height,{fill:this.fill,seed:1}),t.restore()}getAnchorPoint(t="center"){switch(t){case"top":return{x:this.x+this.width/2,y:this.y};case"bottom":return{x:this.x+this.width/2,y:this.y+this.height};case"left":return{x:this.x,y:this.y+this.height/2};case"right":return{x:this.x+this.width,y:this.y+this.height/2};case"center":default:return{x:this.x+this.width/2,y:this.y+this.height/2}}}anchorToPoint(t,e,s="move"){const i=this.getAnchorPoint(t);if(s==="move"){this.x+=e.x-i.x,this.y+=e.y-i.y;return}if(t==="top"){const o=this.getAnchorPoint("bottom");this.y=e.y,this.height=Math.max(1,o.y-e.y)}else if(t==="bottom")this.height=Math.max(1,e.y-this.y);else if(t==="left"){const o=this.getAnchorPoint("right");this.x=e.x,this.width=Math.max(1,o.x-e.x)}else t==="right"&&(this.width=Math.max(1,e.x-this.x))}}class Pe{constructor({start:t={x:0,y:0},end:e={x:0,y:100},coils:s=8,amplitude:i=10,lineWidth:o=3}={}){this.start={...t},this.end={...e},this.coils=s,this.amplitude=i,this.lineWidth=o}move(t,e){this.start.x+=t,this.start.y+=e,this.end.x+=t,this.end.y+=e}render(t,e,{shadow:s=!1,shadowOffset:i=10}={},o=this.start,a=this.end){this.start={...o},this.end={...a};const r=[this.start];for(let h=0;h<this.coils;h++){const f=(h+.5)/this.coils;r.push({x:this.start.x+(h%2===0?-this.amplitude:this.amplitude),y:this.start.y+f*(this.end.y-this.start.y)})}if(r.push(this.end),s){t.save(),t.globalAlpha=.25,t.strokeStyle="rgba(0,0,0,1)",t.filter="none",t.lineWidth=this.lineWidth+1,t.lineJoin="round",t.lineCap="round",t.beginPath();const h=r[0];t.moveTo(h.x+i,h.y+i);for(let f=1;f<r.length;f++){const p=r[f];t.lineTo(p.x+i,p.y+i)}t.stroke(),t.restore()}for(let h=0;h<r.length-1;h++){const f=r[h],p=r[h+1];s||(e?(t.save(),t.filter="none",e.line(f.x,f.y,p.x,p.y,{seed:10+h,strokeWidth:.5}),t.restore()):(t.save(),t.filter="blur(0px)",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(p.x,p.y),t.lineWidth=1,t.stroke(),t.restore()))}}getAnchorPoint(t="start"){return t==="end"||t==="bottom"?{...this.end}:t==="center"?{x:(this.start.x+this.end.x)/2,y:(this.start.y+this.end.y)/2}:t==="top"?{...this.start}:{...this.start}}}class ze{constructor({start:t={x:0,y:0},end:e={x:0,y:120},bodyWidth:s=20,bodyHeight:i=20,lineWidth:o=2,linelength:a=10}={}){this.start={...t},this.end={...e},this.bodyWidth=s,this.bodyHeight=i,this.lineWidth=o,this.linelength=a}move(t,e){this.start.x+=t,this.start.y+=e,this.end.x+=t,this.end.y+=e}render(t,e,{shadow:s=!1,shadowOffset:i=10}={},o=this.start,a=this.end){this.start={...o},this.end={...a},this.end.y-this.start.y;const r=this.start.y+this.linelength,h=this.end.y-this.linelength;let f=h-r;const p=this.start.x,w=this.bodyWidth/2,v=(F,T,b,u,S)=>{s?(t.save(),t.fillStyle="rgba(0,0,0,1)",t.filter="blur(2.5px)",t.beginPath(),t.moveTo(F+i,T+i),t.lineTo(b+i,u+i),t.lineWidth=this.lineWidth,t.stroke(),t.restore()):e?(t.save(),t.filter="none",e.line(F,T,b,u,{seed:S,strokeWidth:.5}),t.restore()):(t.save(),t.filter="blur(0px)",t.beginPath(),t.moveTo(F,T),t.lineTo(b,u),t.lineWidth=this.lineWidth,t.stroke(),t.restore())};v(p,this.start.y,p,r,1),v(p,h,p,this.end.y,2),s?(t.save(),t.fillStyle="rgba(0,0,0,1)",t.filter="blur(2.5px)",t.fillRect(p-w+i,r+i,this.bodyWidth,f),t.restore()):e?(t.save(),t.filter="none",e.rectangle(p-w,r,this.bodyWidth,f,{fill:"white",fillStyle:"solid",seed:3}),e.rectangle(p-w,r,this.bodyWidth,f,{fill:"grey",seed:3}),t.restore()):(t.save(),t.fillStyle="rgb(200,200,200)",t.fillRect(p-w,r,this.bodyWidth,f),t.restore())}getAnchorPoint(t="start"){return t==="end"||t==="bottom"?{...this.end}:t==="center"?{x:(this.start.x+this.end.x)/2,y:(this.start.y+this.end.y)/2}:t==="top"?{...this.start}:{...this.start}}}class ke{constructor({x:t=0,y:e=0,width:s=120,hatchCount:i=30,hatchSpacing:o=4,hatchLength:a=7,hatchDrop:r=7}={}){this.x=t,this.y=e,this.width=s,this.hatchCount=i,this.hatchSpacing=o,this.hatchLength=a,this.hatchDrop=r}move(t,e){this.x+=t,this.y+=e}render(t,e,{shadow:s=!1,shadowOffset:i=10}={}){const o=Math.max(1,Math.ceil(this.width/this.hatchSpacing)),a=(r,h,f,p,w)=>{s?(t.save(),t.fillStyle="rgba(0,0,0,1)",t.filter="blur(2.5px)",t.beginPath(),t.moveTo(r+i,h+i),t.lineTo(f+i,p+i),t.stroke(),t.restore()):e?(t.save(),t.filter="none",e.line(r,h,f,p,{seed:w}),t.restore()):(t.save(),t.filter="blur(0px)",t.beginPath(),t.moveTo(r,h),t.lineTo(f,p),t.stroke(),t.restore())};a(this.x,this.y,this.x+this.width,this.y,1);for(let r=0;r<o;r++){const h=this.x+r*this.hatchSpacing;a(h,this.y,h+this.hatchLength,this.y+this.hatchDrop,2+r)}}getAnchorPoint(t="top"){switch(t){case"left":return{x:this.x,y:this.y};case"right":return{x:this.x+this.width,y:this.y};case"center":return{x:this.x+this.width/2,y:this.y};case"top":default:return{x:this.x+this.width/2,y:this.y}}}anchorToPoint(t,e,s="move"){const i=this.getAnchorPoint(t);if(s==="move"){this.x+=e.x-i.x,this.y+=e.y-i.y;return}if(t==="left"){const o=this.getAnchorPoint("right");this.x=e.x,this.width=Math.max(1,o.x-e.x)}else t==="right"&&(this.width=Math.max(1,e.x-this.x))}}class se{constructor({x:t=0,y:e=0,massWidth:s=100,massHeight:i=100,springLength:o=160,spacing:a=null,showDamper:r=!0,showGround:h=!0,useGroundAnchor:f=h,groundX:p=null,groundY:w=null,groundWidth:v=null,groundFixed:F=!0,labels:T={},labelStyle:b={},forceArrow:u={}}={}){this.x=t,this.y=e,this.mass=new Te({x:t,y:e,width:s,height:i,fill:"grey"}),this.spring=new Pe({start:{x:t,y:e+i},end:{x:t,y:e+i+o}}),this.damper=new ze({start:{x:t+s/2,y:e+i},end:{x:t+s/2,y:e+i+o}});const S=t-s*.1,J=e+i+o,st=s*1.2;this.ground=new ke({x:p??S,y:w??J,width:v??st}),this.showDamper=r,this.showGround=h,this.useGroundAnchor=f,this.spacing=a??s*.25,this.springLength=o,this.groundFixed=F,this.labels={springLeft:T.springLeft??null,damperRight:T.damperRight??null,massCenter:T.massCenter??null},this.labelStyle={font:b.font??"16px Arial, Helvetica, sans-serif",color:b.color??"#111",background:b.background??"rgba(255,255,255,0.9)",padding:b.padding??4,blur:b.blur??6,offset:b.offset??23,springOffset:b.springOffset??null,damperOffset:b.damperOffset??null,smoothing:b.smoothing??1},this.forceArrow={enabled:u.enabled??!1,direction:u.direction??"right",anchor:u.anchor??"center",anchorT:u.anchorT??.5,length:u.length??40,offset:u.offset??12,headSize:u.headSize??8,lineWidth:u.lineWidth??3,color:u.color??"#f6a04d",label:u.label??null,labelOffset:u.labelOffset??12,labelFont:u.labelFont??b.font??"16px Arial, Helvetica, sans-serif",labelColor:u.labelColor??"#f18f3b"},this._labelPositions={springLeft:null,damperRight:null,massCenter:null},this.layout()}setMassSize(t,e){this.mass.width=t,this.mass.height=e,this.spacing=t*.25,this.layout()}setSpringLength(t){this.springLength=t,this.layout()}setMassTop(t){this.mass.anchorToPoint("top",t,"move"),this.layout()}setMassPosition(t,e){this.mass.x=t,this.mass.y=e,this.layout()}setForceArrow(t={}){this.forceArrow={...this.forceArrow,...t}}layout(){this.x=this.mass.x,this.y=this.mass.y;const t=this.mass.getAnchorPoint("bottom"),e={x:t.x-this.spacing,y:t.y},s={x:t.x+this.spacing,y:t.y},i=this.ground.y,o=this.useGroundAnchor?{x:e.x,y:i}:{x:e.x,y:e.y+this.springLength};this.spring.start={...e},this.spring.end={...o};const a=this.useGroundAnchor?{x:s.x,y:i}:{x:s.x,y:s.y+this.springLength};if(this.damper.start={...s},this.damper.end={...a},!this.groundFixed){const r=Math.max(this.spring.end.y,this.damper.end.y);this.ground.x=this.mass.x-this.mass.width*.1,this.ground.y=r,this.ground.width=this.mass.width*1.2}}render(t,e,s={},i=null){if(typeof i=="number"){const o=Math.max(0,Math.min(1,i)),a=this.ground.y-this.mass.height,r=a-this.springLength;this.mass.y=a+(r-a)*o}if(this.layout(),s.shadow){this.mass.render(t,e,s),this.spring.render(t,e,s,this.spring.start,this.spring.end),this.showDamper&&this.damper.render(t,e,s,this.damper.start,this.damper.end),this.showGround&&this.ground.render(t,e,s);return}this.mass.render(t,e,s),this.spring.render(t,e,s,this.spring.start,this.spring.end),this.showDamper&&this.damper.render(t,e,s,this.damper.start,this.damper.end),this.showGround&&this.ground.render(t,e,s),!s.shadow&&this.forceArrow.enabled&&this.drawForceArrow(t),this.renderLabels(t)}getAnchorPoint(t,e=.5){if(t==="massTop"){const s=Math.max(0,Math.min(1,e));return{x:this.mass.x+s*this.mass.width,y:this.mass.y}}return t==="ground"?{x:(this.spring.end.x+this.damper.end.x)/2,y:(this.spring.end.y+this.damper.end.y)/2}:this.mass.getAnchorPoint("center")}renderLabels(t){const{springLeft:e,damperRight:s,massCenter:i}=this.labels;if(!e&&!s&&!i)return;const o=this.labelStyle.offset,a=this.labelStyle.springOffset??o,r=this.labelStyle.damperOffset??o;if(e){const h=this.spring.getAnchorPoint("center"),f={x:h.x-a,y:h.y};this.drawLabel(t,e,this._smoothLabelPoint("springLeft",f),!1)}else this._labelPositions.springLeft=null;if(s){const h=this.damper.getAnchorPoint("center"),f={x:h.x+r,y:h.y};this.drawLabel(t,s,this._smoothLabelPoint("damperRight",f),!1)}else this._labelPositions.damperRight=null;if(i){const h=this.mass.getAnchorPoint("center");this.drawLabel(t,i,this._smoothLabelPoint("massCenter",h),!0)}else this._labelPositions.massCenter=null}_smoothLabelPoint(t,e){const s=Math.max(0,Math.min(1,this.labelStyle.smoothing));if(!Number.isFinite(s)||s>=1)return this._labelPositions[t]={...e},this._labelPositions[t];const i=this._labelPositions[t];if(!i)return this._labelPositions[t]={...e},this._labelPositions[t];const o={x:i.x+(e.x-i.x)*s,y:i.y+(e.y-i.y)*s};return this._labelPositions[t]=o,o}drawLabel(t,e,s,i){t.save(),t.font=this.labelStyle.font,t.fillStyle=this.labelStyle.color,t.textAlign="center",t.textBaseline="middle";const o=t.measureText(e),a=this.labelStyle.padding,r=o.width+a*2,h=16+a*2,f=s.x-r/2,p=s.y-h/2;i&&(t.shadowColor=this.labelStyle.background,t.shadowBlur=this.labelStyle.blur,t.fillStyle=this.labelStyle.background,t.fillRect(f,p,r,h),t.shadowBlur=0),t.fillStyle=this.labelStyle.color,t.fillText(e,s.x,s.y),t.restore()}drawForceArrow(t){const{direction:e,anchor:s,anchorT:i,length:o,offset:a,headSize:r,lineWidth:h,color:f,label:p,labelOffset:w,labelFont:v,labelColor:F}=this.forceArrow,T=this._getForceAnchorPoint(s,i),b=this._getForceDirection(e),u={x:T.x+b.x*a,y:T.y+b.y*a},S={x:u.x-b.x*o,y:u.y-b.y*o};t.save(),t.strokeStyle=f,t.fillStyle=f,t.lineWidth=h,t.lineCap="round",t.beginPath(),t.moveTo(S.x,S.y),t.lineTo(u.x,u.y),t.stroke();const J=Math.atan2(u.y-S.y,u.x-S.x),st=J+Math.PI-Math.PI/6,mt=J+Math.PI+Math.PI/6;if(t.beginPath(),t.moveTo(u.x,u.y),t.lineTo(u.x+Math.cos(st)*r,u.y+Math.sin(st)*r),t.lineTo(u.x+Math.cos(mt)*r,u.y+Math.sin(mt)*r),t.closePath(),t.fill(),t.restore(),p){const B={x:(S.x+u.x)/2,y:(S.y+u.y)/2},V={x:-b.y,y:b.x},tt={x:B.x+V.x*w,y:B.y+V.y*w};t.save(),t.font=v,t.fillStyle=F,t.textAlign="center",t.textBaseline="middle",t.fillText(p,tt.x,tt.y),t.restore()}}_getForceAnchorPoint(t,e=.5){return t==="massTop"?this.getAnchorPoint("massTop",e):t==="topLeft"?{x:this.mass.x,y:this.mass.y}:t==="topRight"?{x:this.mass.x+this.mass.width,y:this.mass.y}:t==="bottomLeft"?{x:this.mass.x,y:this.mass.y+this.mass.height}:t==="bottomRight"?{x:this.mass.x+this.mass.width,y:this.mass.y+this.mass.height}:t==="top"?this.mass.getAnchorPoint("top"):t==="bottom"?this.mass.getAnchorPoint("bottom"):t==="left"?this.mass.getAnchorPoint("left"):t==="right"?this.mass.getAnchorPoint("right"):this.mass.getAnchorPoint("center")}_getForceDirection(t){switch(t){case"left":return{x:-1,y:0};case"up":return{x:0,y:-1};case"down":return{x:0,y:1};case"right":default:return{x:1,y:0}}}}class Re{constructor({Massmatrix:t=null,Dampingmatrix:e=null,Stiffnessmatrix:s=null,Maxtimestep:i=1,StartingPositions:o=null,StartingVelocities:a=null}={}){var h;this.Massmatrix=t,this.Dampingmatrix=e,this.Stiffnessmatrix=s?n.matrix(s):null,this.Maxtimestep=i;const r=(h=this.Massmatrix)!=null&&h.size?this.Massmatrix.size()[0]:0;o==null&&(o=r?n.zeros(r,1):null),a==null&&(a=r?n.zeros(r,1):null),this.Currentposition=o,this.Currentvelocity=a,this._buildStateSpace(),this.state=n.concat(this.Currentvelocity,this.Currentposition),this.ForceType="step",this.ForceApplicationtime1=null,this.ForceApplicationtime2=null,this.ForceRampStart=0,this.ForceRampupTime=null,this.Forcefrequency=1,this.Amplitude=n.identity([r,r])*this.Amplitude,this.lastanim=0,this.Starttime=0}reinitialize({StartingPositions:t=null,StartingVelocities:e=null}={}){var i;const s=(i=this.Massmatrix)!=null&&i.size?this.Massmatrix.size()[0]:0;t==null&&(t=s?n.zeros(s,1):null),e==null&&(e=s?n.zeros(s,1):null),this.Currentposition=t,this.Currentvelocity=e,this.state=n.flatten(n.concat(this.Currentvelocity,this.Currentposition)),this.Starttime=Date.now()}set AppliedForceParameters({ForceType:t="step",Amplitude:e=1,ForceApplicationtime1:s=null,ForceApplicationtime2:i=null,Forcefrequency:o=1,ForceRampStart:a=null,ForceRampupTime:r=null}={}){this.ForceType=t,this.Amplitude=e,this.ForceApplicationtime1=s,this.ForceApplicationtime2=i,this.Forcefrequency=o,this.ForceRampStart=a,this.ForceRampupTime=r}setMassmatrix(t){if(Et(t))this.Massmatrix=t;else throw new Error("Massmatrix must be a math matrix");this._buildStateSpace()}setDampingmatrix(t){if(Et(t))this.Dampingmatrix=t;else throw new Error("Dampingmatrix must be a math matrix");this.Dampingmatrix=t,this._buildStateSpace()}setStiffnessmatrix(t){if(Et(t))this.Stiffnessmatrix=t;else throw new Error("Stiffnessmatrix must be a math matrix");this.Stiffnessmatrix=t,this._buildStateSpace()}_buildStateSpace(){var f;const t=(f=this.Massmatrix)!=null&&f.size?this.Massmatrix.size()[0]:0;if(!t){this._A=null,this._B=null,this._C=null;return}let e=n.concat(n.multiply(-1,this.Dampingmatrix,n.inv(this.Massmatrix)),n.multiply(-1,this.Stiffnessmatrix,n.inv(this.Massmatrix)),1),s=n.concat(n.identity(t),n.zeros([t,t]),1),i=n.concat(e,s,0),o=n.multiply(n.inv(this.Massmatrix),n.ones([t,1]));o=n.concat(o,n.zeros([t,1]),0),o=n.matrix(o);let a=n.concat(n.identity(t),n.zeros([t,t]),1),r=n.concat(n.zeros([t,t]),n.identity(t),1),h=n.concat(a,r,0);try{this.eigs=n.eigs(i)}catch{this.eigs=void 0}this._A=i,this._B=o,this._C=h}getEigenvaluesAndVectors(){return typeof this.eigs<"u"?this.eigs:null}_timewithintimeframe(t,e,s){if(e!=null&&s!=null)return t>=e&&t<=s;if(e!=null)return t>=e;if(s!=null)return t<=s}calcForceAtTime(t){let e=n.zeros(this.Massmatrix.size()[0],1);if(this.ForceType==="step")this.ForceApplicationtime1!=null&&t>=this.ForceApplicationtime1&&(e=n.add(e,n.multiply(this.Amplitude,1)));else if(this.ForceType==="impulse")this.ForceApplicationtime1!=null&&Math.abs(t-this.ForceApplicationtime1)<1e-6&&(e=n.add(e,n.multiply(this.Amplitude,1)));else if(this.ForceType==="sine"){let s=1;if(Number.isFinite(this.ForceRampupTime)&&this.ForceRampupTime>0){const o=Number.isFinite(this.ForceRampStart)?this.ForceRampStart:0,a=t-o;if(a<=0)s=0;else if(a<this.ForceRampupTime){const r=Math.PI*a/this.ForceRampupTime;s=.5*(1-Math.cos(r))}}const i=Math.sin(2*Math.PI*this.Forcefrequency*t)*s;e=n.multiply(this.Amplitude,i).toArray()}return e}getFullTimeFunction(t,e,s="position"){const i=t.length;let o=n.zeros(i,self.Massmatrix.size()[0]),a=n.zeros(i,self.Massmatrix.size()[0]);o[0]=this.Currentposition,a[0]=this.Currentvelocity;for(let r=1;r<i;r++){let h=this.calcForceAtTime(t[r]),f=n.concat(o[r-1],a[r-1],0),p=t[r]-t[r-1],w=n.add(n.identity(f.size()[0]),n.multiply(this._A,p)),v=n.multiply(this._B,p),F=n.add(n.multiply(w,f),n.multiply(v,h));o[r]=F.subset(n.index(n.range(0,this.Massmatrix.size()[0]),0)),a[r]=F.subset(n.index(n.range(this.Massmatrix.size()[0],2*this.Massmatrix.size()[0]),0))}if(s==="position")return o.map(r=>r[e]);if(s==="velocity")return a.map(r=>r[e]);throw new Error(`Invalid resulttype: ${s}`)}getBodePlotData(t,e,s="magnitude",i=0){const o=t.length;let a=new Array(o).fill(0),r=new Array(o).fill(0);for(let h=0;h<o;h++){const f=t[h],p=2*Math.PI*f,w=n.complex(0,1),v=n.multiply(w,p),F=n.add(this.Stiffnessmatrix,n.multiply(v,this.Dampingmatrix),n.multiply(v,v,this.Massmatrix)),u=n.inv(F).subset(n.index(e,i)),S=n.abs(u),J=n.arg(u)*(180/Math.PI);a[h]=S,r[h]=J}if(s==="magnitude")return a;if(s==="phase")return r;throw new Error(`Invalid resulttype: ${s}`)}stepSimulation(t){this.lastanim==0&&(this.lastanim=t),this.Starttime==0&&(this.Starttime=t);const e=(r,h)=>{let f=this.calcForceAtTime(t+r).concat(n.flatten(n.zeros(this.Massmatrix.size()[0],1).toArray())),p=n.multiply(this._A,n.transpose(h)),w=n.dotMultiply(n.matrix(n.flatten(this._B).toArray()),f);return n.flatten(n.add(n.flatten(p),w)).toArray()};let s=t-this.lastanim;s>10&&(s=10);let i=n.solveODE(e,[0,s],[this.state],{maxStep:.1});this.lastanim=t,this.state=n.flatten(i.y[i.y.length-1]);let o=n.multiply(this._C,n.transpose(this.state));o=n.flatten(o);const a=this.Massmatrix.size()[0];return this.Currentvelocity=n.subset(o,n.index(n.range(0,a))),this.Currentposition=n.subset(o,n.index(n.range(a,2*a))),{position:this.Currentposition,velocity:this.Currentvelocity}}}const Q=ie(ne);function qe(k,t={}){if(!k)return;const e=window.JXG;if(!e||!e.JSXGraph){console.warn("JSXGraph not found. Include jsxgraphcore.js before initializing the demo.");return}const i=(window.TemplateSettings||{}).jsxGraphColors||{},o=(l,m)=>(getComputedStyle(document.documentElement).getPropertyValue(`--jxg-color-${l}`)||"").trim()||m,a={axis:i.axis||"#333",m1:o(1,i.m1||"#1f77b4"),m2:o(2,i.m2||"#d62728"),reference:o(3,i.reference||"#6c757d"),resonance:o(3,i.resonance||"#6c757d"),antiResonance:o(5,i.antiResonance||"#2e7d32"),excitation:o(4,i.excitation||"#f57c00"),background:i.background||"#fff",border:i.border||"#ddd"};k._msdAnchorsCleanup&&(k._msdAnchorsCleanup(),k._msdAnchorsCleanup=null);const r=t.bodeTarget||(typeof t.bodeTargetId=="string"?document.getElementById(t.bodeTargetId):null),h=t.controlsTarget||(typeof t.controlsTargetId=="string"?document.getElementById(t.controlsTargetId):null);k.innerHTML="";const f=!r||!h||r===k||h===k;let p=null;f&&(p=document.createElement("div"),p.style.display="flex",p.style.gap="9px",p.style.alignItems="stretch",p.style.height="100%",p.style.width="100%",k.appendChild(p));const w=document.createElement("div");w.style.display="flex",w.style.flexDirection="column",w.style.gap="1px",w.style.width="100%",w.style.height="120%",w.style.flex="0 0 auto",(p||k).appendChild(w);const v=document.createElement("canvas");v.style.width="100%",v.style.height="100%",v.style.flex="1 1 0",v.style.border="none",w.appendChild(v);const F=document.createElement("div");F.style.display="flex",F.style.flexDirection="column",F.style.alignItems="flex-start",F.style.gap="8px",f?F.style.flex="0 0 300px":F.style.width="100%",F.style.height="100%",(p||r||k).appendChild(F);const T=document.createElement("div");T.style.display="flex",T.style.alignItems="flex-start",T.style.justifyContent="flex-start",T.style.gap="16px",T.style.padding="0 6px",T.style.minHeight="52px",F.appendChild(T);const b=document.createElement("div");b.style.display="flex",b.style.flexDirection="column",b.style.gap="2px",b.style.fontSize="11px",b.style.color="#333",T.appendChild(b);const u=document.createElement("div");u.style.display="flex",u.style.flexDirection="column",u.style.gap="2px",u.style.fontSize="11px",u.style.color="#333",u.style.alignItems="flex-end",u.style.minHeight="44px",T.appendChild(u);const S=document.createElement("div");S.id=`msd-bode-${Math.random().toString(36).slice(2)}`,S.style.flex="0 0 auto",S.style.width="100%",S.style.height="250px",S.style.border="none",S.style.background=a.background,F.appendChild(S);const J=(l,m,y=!1)=>{const d=document.createElement("div");d.style.display="flex",d.style.alignItems="center",d.style.gap="6px";const c=document.createElement("span");c.style.width="18px",c.style.height="2px",c.style.background=m,y&&(c.style.background="none",c.style.borderTop=`2px dashed ${m}`);const g=document.createElement("span");return g.textContent=l,d.appendChild(c),d.appendChild(g),b.appendChild(d),d};J("m1",a.m1);const st=J("m2",a.m2),mt=J("Kein Tilger",a.m2,!0),B=document.createElement("div");B.style.display="flex",B.style.flexDirection="column",B.style.gap="8px",B.style.minWidth="100px",B.style.fontFamily="Arial, Helvetica, sans-serif",B.style.fontSize="12px",B.style.color="#111",(p||h||k).appendChild(B);const V=v.getContext("2d"),tt=Ae.canvas(v);let ut=0,pt=0,wt=0,Ct=0,x=null,ft=0,_t=0;const E=new se({x:0,y:0,massWidth:120,massHeight:60,springLength:100,showDamper:!0,showGround:!0,labels:{springLeft:"k1",damperRight:"c1",massCenter:"m1"},labelStyle:{damperOffset:30},forceArrow:{length:60,label:"F(t)",enabled:!0,direction:"down",anchor:"topRight",offset:-1,label:"F(t)",labelOffset:-15}}),_=new se({x:0,y:0,massWidth:50,massHeight:30,springLength:100,showDamper:!0,showGround:!1,useGroundAnchor:!0,labels:{springLeft:"k2",damperRight:"c2",massCenter:"m2"},labelStyle:{damperOffset:30}}),it=1,yt=.1,lt=(1*2*Math.PI)**2*it;let Y=.1,N=.001,gt=1,j=Y*(2*Math.PI*gt)**2,W=!0;const Dt=[0,0],Lt=[0,0];let et=1;const It={min:0,max:2},qt=0,Bt=10;let re=Q.matrix([[yt+N,-N],[-N,N]]),oe=Q.matrix([[lt+j,-j],[-j,j]]),ae=Q.matrix([[it,0],[0,Y]]);const P=new Re({Massmatrix:ae,Stiffnessmatrix:oe,Dampingmatrix:re,StartingPositions:Dt,StartingVelocities:Lt,NumMasses:2});let Wt=Q.matrix([1,0]);P.AppliedForceParameters={ForceType:"sine",Amplitude:Wt,Forcefrequency:et,ForceRampStart:qt,ForceRampupTime:Bt};const Gt=l=>{const m=()=>window.MathJax&&typeof window.MathJax.typesetPromise=="function"?(window.MathJax.typesetPromise(l).catch(()=>{}),!0):!1;if(m())return;const y=document.getElementById("MathJax-script");y&&y.addEventListener("load",()=>m(),{once:!0})},St=(l,m)=>{const y=String(m),d=y.includes(".")?y.split(".")[1].length:0;return l.toFixed(d)},vt=({label:l,min:m,max:y,step:d,value:c,onInput:g})=>{const C=document.createElement("label");C.style.display="flex",C.style.flexDirection="column",C.style.gap="4px";const z=document.createElement("span"),R=document.createElement("span"),D=document.createElement("span"),I=document.createElement("span"),O=typeof l=="string"&&/\\\(|\\\[|\$\$/.test(l);R.textContent=l,D.textContent=": ",I.textContent=St(c,d),z.appendChild(R),z.appendChild(D),z.appendChild(I);const A=document.createElement("input");A.type="range",A.min=m,A.max=y,A.step=d,A.value=c,A.style.width="100%",A.style.boxSizing="border-box",A.addEventListener("input",()=>{const L=parseFloat(A.value);I.textContent=St(L,d),g(L)});const U=(L,{emit:K=!0}={})=>{const rt=parseFloat(L);Number.isFinite(rt)&&(A.value=rt,I.textContent=St(rt,d),K&&g(rt))};return C.appendChild(z),C.appendChild(A),B.appendChild(C),O&&Gt([R]),{input:A,setValue:U}},le=({label:l,checked:m,onChange:y})=>{const d=document.createElement("label");d.style.display="flex",d.style.alignItems="center",d.style.gap="6px";const c=document.createElement("button");c.type="button",c.setAttribute("role","switch"),c.style.position="relative",c.style.width="34px",c.style.height="18px",c.style.border="none",c.style.borderRadius="999px",c.style.padding="0",c.style.cursor="pointer",c.style.background="#999",c.style.transition="background 0.15s ease";const g=document.createElement("span");g.style.position="absolute",g.style.top="2px",g.style.left="2px",g.style.width="14px",g.style.height="14px",g.style.borderRadius="50%",g.style.background="#fff",g.style.transition="transform 0.15s ease",c.appendChild(g);const C=document.createElement("span");C.textContent=l;const z=R=>{c.setAttribute("aria-checked",R?"true":"false"),c.style.background=R?"#2e7d32":"#999",g.style.transform=R?"translateX(16px)":"translateX(0px)"};return z(m),c.addEventListener("click",()=>{m=!m,z(m),y(m)}),d.appendChild(c),d.appendChild(C),B.appendChild(d),{button:c,setState:z}};let Ft=null,At=null,Tt=null;const $t=()=>{if(!Ft||!At||!Tt)return;const l=!W;Ft.input.disabled=l,At.input.disabled=l,Tt.input.disabled=l},Pt=()=>{const l=performance.now();Vt=l,kt=l,P.reinitialize({StartingPositions:Dt,StartingVelocities:Lt}),P.lastanim=0,P.Starttime=0};le({label:"Tilger aktivieren",checked:W,onChange:l=>{W=l,Pt(),$t()}});const nt=document.createElement("button");nt.type="button",nt.textContent="Reset positions",nt.style.padding="4px 8px",nt.style.fontSize="12px",nt.addEventListener("click",()=>{Pt()}),B.appendChild(nt),Ft=vt({label:"Masse Tilger [kg]",min:.05,max:1,step:.01,value:Y,onInput:l=>{Y=l,j=Y*(2*Math.PI*gt)**2}}),At=vt({label:"\\(F_{\\mathrm{Tilger}}\\) [Hz]",min:.5,max:2,step:.1,value:gt,onInput:l=>{gt=l,j=Y*(2*Math.PI*l)**2}}),Tt=vt({label:"TilgerdÃ¤mpfung",min:0,max:.5,step:.01,value:N,onInput:l=>{N=l}}),$t();let Xt=Y,Ht=N,Jt=j,Yt=W,Nt=et,ht=!0,zt=[],xt=null;const Z={freqMin:It.min,freqMax:It.max,samples:240,snapHz:.08},he=()=>{if(Y===Xt&&N===Ht&&j===Jt&&et===Nt&&W===Yt)return;const l=W?N:0,m=W?j:0,y=Q.matrix([[yt+l,-l],[-l,l]]),d=Q.matrix([[lt+m,-m],[-m,m]]),c=Q.matrix([[it,0],[0,Y]]);P.setMassmatrix(c),P.setDampingmatrix(y),P.setStiffnessmatrix(d),P.AppliedForceParameters={ForceType:"sine",Amplitude:Wt,Forcefrequency:et,ForceRampStart:qt,ForceRampupTime:Bt},Xt=Y,Ht=N,Jt=j,Nt=et,Yt=W,ht=!0},jt=(l,m)=>{if(!isFinite(l)||l<=0)return 1;const y=l/Math.max(1,m),d=Math.pow(10,Math.floor(Math.log10(y))),c=y/d;let g=1;return c<1.5?g=1:c<3?g=2:c<7?g=5:g=10,g*d},de=(l,m,y)=>{let d=l,c=y;return m.forEach(g=>{const C=Math.abs(l-g);C<=c&&(c=C,d=g)}),d},ce=(l,{snap:m=!1}={})=>{let y=l;m&&(y=de(y,zt,Z.snapHz)),et=Math.min(Z.freqMax,Math.max(Z.freqMin,y)),ht=!0},me=()=>{if(!(P!=null&&P.Massmatrix)||!(P!=null&&P.Stiffnessmatrix))return[];const m=Q.multiply(Q.inv(P.Massmatrix),P.Stiffnessmatrix).toArray();if(m.length!==2||m[0].length!==2)return[];const y=m[0][0],d=m[0][1],c=m[1][0],g=m[1][1],C=y+g,z=y*g-d*c,R=C*C-4*z;if(!isFinite(R))return[];const D=Math.sqrt(Math.max(0,R)),I=(C+D)/2,O=(C-D)/2,A=[];return I>0&&A.push(Math.sqrt(I)/(2*Math.PI)),O>0&&A.push(Math.sqrt(O)/(2*Math.PI)),A.sort((U,L)=>U-L)},ue=()=>W?me():[Math.sqrt(lt/it)/(2*Math.PI)],Ot=(l,m,y,d)=>l.map(c=>{const g=2*Math.PI*c,C=d-m*g*g,z=y*g;return 1/Math.sqrt(C*C+z*z)}),pe=(l,m,y,d,c)=>{if(y.length<2)return null;const g=Math.max(y[0],d),C=Math.min(y[y.length-1],c);if(g>=C)return null;let z=null,R=1/0;for(let D=0;D<l.length;D+=1){const I=l[D];if(I<g||I>C)continue;const O=m[D];O<R&&(R=O,z=I)}return z},fe=()=>{if(!wt||!Ct)return;const l=Z.freqMin,m=Z.freqMax,y=Z.samples,d=[];for(let M=0;M<=y;M+=1)d.push(l+(m-l)*M/y);let c=null;const g=W?P.getBodePlotData(d,0,"magnitude",0):Ot(d,it,yt,lt),C=W?Ot(d,it,yt,lt):null;W&&(c=P.getBodePlotData(d,1,"magnitude",0));const z=M=>20*Math.log10(Math.max(M,1e-8)),R=g.map(z),D=c?c.map(z):[],I=C?C.map(z):[],O=D.length?R.concat(D):R.slice();let A=Math.min(...O),U=Math.max(...O);if(!isFinite(A)||!isFinite(U))return;A===U?(A-=1,U+=1):(A-=5,U+=5);const L=l,K=m,rt=jt(m-l,6),Rt=jt(U-A,6);let G=-60,H=Math.ceil(U/Rt)*Rt;xt||(xt={min:G,max:H}),G=xt.min,H=xt.max;const bt=ue().filter(M=>M>=L&&M<=K),ot=pe(d,g,bt,L,K);zt=bt.slice(),ot!=null&&zt.push(ot),x&&(e.JSXGraph.freeBoard(x),x=null),x=e.JSXGraph.initBoard(S.id,{boundingbox:[L-.1,H,K,G-5],axis:!1,pan:{enabled:!1},zoom:{enabled:!1},showNavigation:!1,showCopyright:!1}),x.suspendUpdate();const at=a.axis,ge=x.create("axis",[[L,G],[K,G]],{strokeColor:at,ticks:{visible:!1}}),xe=x.create("axis",[[L,G],[L,H]],{strokeColor:at,ticks:{visible:!1}});x.create("ticks",[ge,6],{ticksDistance:rt,minorTicks:4,label:{fontSize:11},strokeColor:at}),x.create("ticks",[xe,6],{ticksDistance:Rt,minorTicks:4,label:{fontSize:11},strokeColor:at}),x.create("text",[K,G+(H-G)*.05,"Hz"],{anchorX:"right",anchorY:"bottom",fixed:!0,fontSize:11,strokeColor:at}),x.create("text",[L+(K-L)*.02,H,"dB"],{anchorX:"left",anchorY:"top",fixed:!0,fontSize:11,strokeColor:at}),D.length&&x.create("curve",[d,D],{strokeColor:a.m2,strokeWidth:1}),x.create("curve",[d,R],{strokeColor:a.m1,strokeWidth:1.5}),I.length&&x.create("curve",[d,I],{strokeColor:a.m1,strokeWidth:.5,dash:2}),st.style.visibility=D.length?"visible":"hidden",mt.style.visibility=I.length?"visible":"hidden";const be=H-(H-G)*.04,Me=M=>M.toFixed(2),we=(M,q,X,$=2)=>{x.create("segment",[[M,G],[M,H]],{strokeColor:X,dash:$,strokeWidth:1}),x.create("text",[M,be,q],{anchorX:"middle",anchorY:"top",useMathjax:!0,fixed:!0,fontSize:13,strokeColor:X,background:"rgba(255, 255, 255, 0.5)",cssStyle:"background: rgba(255, 255, 255, 0.7);"})},Ce=(M,q,X)=>{const $=G+(H-G)*.015;x.create("text",[M,$,q],{anchorX:"middle",anchorY:"bottom",useMathjax:!0,fixed:!0,fontSize:13,strokeColor:X,background:"rgba(255, 255, 255, 0.5)",cssStyle:"background: rgba(255, 255, 255, 0.7); padding: 0 1px; line-height: 0.4; display: inline-block;"})};bt.forEach((M,q)=>{we(M,`$$f_{R${q+1}}$$`,a.resonance,1)}),ot!=null&&Ce(ot,"$$f_{AR}$$",a.antiResonance),u.innerHTML="";const Qt=(M,q,X)=>{const $=document.createElement("div"),ct=document.createElement("span");ct.textContent=`\\(${M}\\)`;const Mt=document.createElement("span");Mt.textContent=`=${Me(q)} Hz`,$.appendChild(ct),$.appendChild(Mt),$.style.color=X,u.appendChild($),Gt([ct])};bt.forEach((M,q)=>{Qt(`f_{R${q+1}}`,M,a.resonance)}),ot!=null&&Qt("f_{AR}",ot,a.antiResonance),u.style.visibility=u.childElementCount?"visible":"hidden";const Zt=Math.min(K,Math.max(L,et));x.create("segment",[[Zt,G],[Zt,H]],{strokeColor:a.excitation,strokeWidth:2});const Se=M=>{var ee;const q=getComputedStyle(document.documentElement).getPropertyValue("--sheet-scale").trim(),X=Number.parseFloat(q)||1,$=S.getBoundingClientRect(),ct=(M.clientX-$.left)/X,Mt=(M.clientY-$.top)/X;if(!((ee=x==null?void 0:x.origin)!=null&&ee.scrCoords))return x.getUsrCoordsOfMouse(M);const te=x.origin.scrCoords,ve=(ct-te[1])/x.unitX,Fe=(te[2]-Mt)/x.unitY;return[ve,Fe]};x.on("down",M=>{const q=Se(M);if(!q||q.length<2)return;const X=q[0];if(!Number.isFinite(X))return;const $=Math.min(Z.freqMax,Math.max(Z.freqMin,X));Pt(),ce($,{snap:!0})}),x.unsuspendUpdate()};(()=>{const l=v.getBoundingClientRect(),m=window.devicePixelRatio||1;ut=l.width,pt=l.height,v.width=Math.max(1,Math.floor(ut*m)),v.height=Math.max(1,Math.floor(pt*m)),V.setTransform(m,0,0,m,0,0);const y=S.getBoundingClientRect(),d=getComputedStyle(S);wt=y.width||parseFloat(d.width)||300,Ct=y.height||parseFloat(d.height)||250,x&&x.resizeContainer(wt,Ct),ht=!0,ft=ut/2,_t=pt-28,E.ground.x=ft-E.ground.width/2,E.ground.y=_t,E.mass.x=ft-E.mass.width/2,E.mass.y=E.ground.y-E.mass.height-E.springLength,_.ground.width=_.mass.width*1.2,_.mass.x=ft-_.mass.width/2,_.ground.x=E.mass.x+E.mass.width/2-_.ground.width/2,_.ground.y=E.mass.y,_.mass.y=_.ground.y-_.mass.height-_.springLength})(),performance.now();let dt=null,Ut=!1;const ye=()=>{Ut=!0,dt!=null&&(window.cancelAnimationFrame(dt),dt=null),x&&(e.JSXGraph.freeBoard(x),x=null)};k._msdAnchorsCleanup=ye;let kt=performance.now(),Vt=kt;const Kt=l=>{if(Ut)return;const m=(l-Vt)/1e3;he(),ht&&(fe(),ht=!1);let y=P.calcForceAtTime(m),d=P.stepSimulation(m);kt=l;let c=d.position.toArray();V.clearRect(0,0,ut,pt);const g=E.getAnchorPoint("massTop",.5);_.ground.x=g.x-_.ground.width/2,_.ground.y=g.y,E.setForceArrow({length:y[0]*100}),E.render(V,tt,{shadow:!0,shadowOffset:6},c[0]+.5),W&&_.render(V,tt,{shadow:!0,shadowOffset:6},c[1]+.5),E.render(V,tt,{},c[0]+.5),W&&_.render(V,tt,{},c[1]+.5),dt=window.requestAnimationFrame(Kt)};dt=window.requestAnimationFrame(Kt)}export{qe as initMassSpringDamperAnchorsDemo};
