const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./rough-template-Cx6s0Y75.js","./roughjs-GtHDBO_d.js","./msd-anchors-demo-BT70O9_B.js","./vendor-iQCKx8iG.js","./mathjs-XxrZN8d5.js"])))=>i.map(i=>d[i]);
(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))m(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const n of e.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&m(n)}).observe(document,{childList:!0,subtree:!0});function r(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function m(t){if(t.ep)return;t.ep=!0;const e=r(t);fetch(t.href,e)}})();const be="modulepreload",Ee=function(u,a){return new URL(u,a).href},ge={},he=function(a,r,m){let t=Promise.resolve();if(r&&r.length>0){let n=function(l){return Promise.all(l.map(c=>Promise.resolve(c).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};const p=document.getElementsByTagName("link"),b=document.querySelector("meta[property=csp-nonce]"),o=(b==null?void 0:b.nonce)||(b==null?void 0:b.getAttribute("nonce"));t=n(r.map(l=>{if(l=Ee(l,m),l in ge)return;ge[l]=!0;const c=l.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(!!m)for(let x=p.length-1;x>=0;x--){const N=p[x];if(N.href===l&&(!c||N.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${d}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":be,c||(f.as="script"),f.crossOrigin="",f.href=l,o&&f.setAttribute("nonce",o),document.head.appendChild(f),c)return new Promise((x,N)=>{f.addEventListener("load",x),f.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${l}`)))})}))}function e(n){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=n,window.dispatchEvent(p),!p.defaultPrevented)throw n}return t.then(n=>{for(const p of n||[])p.status==="rejected"&&e(p.reason);return a().catch(e)})},Se=["yellow","mint","blue","pink","gray"];function we(u={}){const a=document.body,r={...window.TemplateSettings||{},...u.settings||{}},m={...window.SymbolSettings||{},...u.symbolSettings||{}},t=Array.from(document.querySelectorAll(".sheet"));return t.forEach((e,n)=>{e.dataset.pageNumber=n+1,e.id||(e.id=`sheet-${n+1}`)}),{body:a,sheets:t,userSettings:r,symbolSettings:m,lectureTitle:a.dataset.lectureTitle||r.lectureTitle||"Vorlagenkurs",lectureChapter:a.dataset.lectureChapter||r.lectureChapter||"Kapitel",highlightColors:u.highlightColors||Se,audioDefaults:r.audio||{mode:"manual"},markerMap:new Map,videoEntries:[],sheetAudio:[],audioRegistry:[],notesStorageKey:u.notesStorageKey||"sheetNotesStateV1"}}function F(u,a){try{a()}catch(r){console.warn(`${u} failed`,r)}}function ve(u){let a=!1,r=null;function m(){if(a||window.MathJax&&typeof MathJax.typesetPromise=="function")return a=!0,Promise.resolve();if(r)return r;window.MathJax=window.MathJax||{},window.MathJax.tex=window.MathJax.tex||{tags:"ams"};const e=[u.body.dataset.mathjaxSrc,...Array.isArray(u.userSettings.mathJaxSources)?u.userSettings.mathJaxSources:[],"node_modules/mathjax/es5/tex-mml-chtml.js","https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"].filter(Boolean);return r=new Promise((n,p)=>{const b=o=>{if(o>=e.length){p(new Error("MathJax load failed"));return}const l=document.createElement("script");l.id="mathjax-script",l.async=!0,l.src=e[o],l.onload=()=>{a=!0,n()},l.onerror=()=>b(o+1),document.head.appendChild(l)};b(0)}),r}function t(e){m().then(()=>{window.MathJax&&typeof MathJax.typesetPromise=="function"&&MathJax.typesetPromise(e).catch(()=>{})})}return{ensureMathJax:m,typeset:t}}function Ce(u){let a=!1,r=null;function m(){if(a||window.JSZip&&typeof window.JSZip=="function")return a=!0,Promise.resolve();if(r)return r;const t=[u.body.dataset.jszipSrc,...Array.isArray(u.userSettings.jsZipSources)?u.userSettings.jsZipSources:[],"node_modules/jszip/dist/jszip.min.js","https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"].filter(Boolean);return r=new Promise((e,n)=>{const p=b=>{if(b>=t.length){n(new Error("JSZip load failed"));return}const o=document.createElement("script");o.src=t[b],o.async=!0,o.onload=()=>{a=!0,e()},o.onerror=()=>p(b+1),document.head.appendChild(o)};p(0)}),r}return{ensureJSZip:m}}function xe({typeset:u,requestAudioUpdate:a}){let r,m,t,e=!1;const n=()=>e?!0:(r=document.getElementById("subsheet-panel"),m=document.getElementById("subsheet-content"),t=document.getElementById("subsheet-close"),!r||!m||!t?!1:(t.addEventListener("click",()=>{document.body.classList.remove("panel-open"),m.innerHTML="",a()}),e=!0,!0));document.addEventListener("click",p=>{var c,d;const b=(d=(c=p.target).closest)==null?void 0:d.call(c,".sub-page-wrapper");if(!b||!n())return;p.stopPropagation();const o=b.closest(".sheet");if(!o)return;const l=o.querySelectorAll(".sub-page-sheet");m.innerHTML="",l.forEach(g=>m.appendChild(g.cloneNode(!0))),document.body.classList.add("panel-open"),r.scrollTop=0,u([m]),a()})}function Le({sheets:u}){u.forEach(a=>{const r=Number(a.dataset.pageNumber);Array.from(a.querySelectorAll(".sub-page-sheet")).forEach((t,e)=>{t.dataset.subpageId=`${r}-${e+1}`})})}function Ae(u){const{sheets:a,markerMap:r,lectureChapter:m,lectureTitle:t}=u,e=document.getElementById("toc-list");if(!e)return;const n=new Map;a.forEach(o=>{const l=Number(o.dataset.pageNumber);o.querySelectorAll("[data-toc]").forEach(c=>{const d=(c.dataset.toc||"").trim();if(!d)return;const g=d;r.has(g)||r.set(g,[]),r.get(g).push(c);const f=n.get(g);(!f||l<f.page)&&n.set(g,{page:l,sheet:o})})}),e.innerHTML="";const p=Array.from(n.entries()).sort((o,l)=>{const c=o[1].page-l[1].page;return c!==0?c:o[0].localeCompare(l[0])});if(p.forEach(([o,l],c)=>{var _;l.number=c+1;const d=document.createElement("li");d.className="toc-item",d.dataset.target=((_=l.sheet)==null?void 0:_.id)||"",d.setAttribute("role","button"),d.tabIndex=0;const g=document.createElement("span");g.className="toc-number",g.textContent=`${l.number}.`;const f=document.createElement("span");f.className="toc-title";const x=`${l.number}. ${o}`;f.textContent=o;const N=document.createElement("span");N.className="toc-page",N.textContent=l.page,d.append(g,f,N),e.appendChild(d);const I=r.get(o)||[];I.length&&(I[0].textContent=x)}),!e.children.length){const o=document.createElement("li");o.textContent="(keine Eintr√§ge markiert)",e.appendChild(o)}e.addEventListener("click",o=>{const l=o.target.closest(".toc-item[data-target]");if(!l)return;const c=l.dataset.target;if(!c)return;const d=document.getElementById(c);d&&(d.scrollIntoView({behavior:"smooth",block:"start"}),document.body.classList.remove("panel-open"))});const b=o=>{let l=null;return p.forEach(([c,d])=>{d.page<=o&&(l={title:c,number:d.number})}),l};a.forEach(o=>{if(o.classList.contains("Titlepage"))return;const l=Number(o.dataset.pageNumber),c=b(l);if(!c)return;const d=Te(o);let g=o.querySelector(".page-header");g||(g=document.createElement("div"),g.className="page-header",o.appendChild(g)),g.innerHTML=`<span>${m}</span><span>${c.number}. ${c.title}</span>`;let f=o.querySelector(".page-footer");f||(f=document.createElement("div"),f.className="page-footer",o.appendChild(f)),f.innerHTML=`<span class="page-footer__title">${t}</span>`,o.appendChild(Ne(d,l)),o.querySelectorAll(".sub-page-sheet").forEach((x,N)=>{let I=x.querySelector(".page-header");I||(I=document.createElement("div"),I.className="page-header",x.appendChild(I)),I.innerHTML=`<span>${m}</span><span>${c.number}. ${c.title} ‚Äì ${N+1}</span>`;let _=x.querySelector(".page-footer");_||(_=document.createElement("div"),_.className="page-footer",x.appendChild(_)),_.innerHTML=`<span class="page-footer__title">${t}</span>`})})}function fe(u){return(u||"").toString().trim().toLowerCase().replace(/['"()]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}function Te(u){var t,e;if(u.dataset.linkSlug)return u.dataset.linkSlug;const a=u.dataset.link||"",r=((e=(t=u.querySelector("[data-toc]"))==null?void 0:t.dataset)==null?void 0:e.toc)||"";let m=fe(a)||fe(r)||fe(u.id)||`sheet-${u.dataset.pageNumber||""}`;if(m||(m=`sheet-${Date.now()}`),u.dataset.linkSlug=m,!document.getElementById(m)){const n=document.createElement("a");n.id=m,n.className="sheet-link-anchor",n.setAttribute("aria-hidden","true"),u.prepend(n)}return m}function Ne(u,a){const r=document.createElement("a");return r.className="page-number-link",r.href=`#${u}`,r.textContent=a?`${a}`:u,r.title=`Link zu Seite ${a||u} kopieren`,r.addEventListener("click",m=>{var e;m.preventDefault();const t=new URL(window.location.href);t.hash=u,(e=navigator.clipboard)==null||e.writeText(t.toString()).catch(()=>{})}),r}function Ie(u,a){const{sheets:r,symbolSettings:m}=u,t=[],e=o=>{var g;const l=o.id;if(l&&m.byId&&m.byId[l])return m.byId[l];const c=o.querySelector("[data-toc]"),d=(g=c==null?void 0:c.dataset.toc)==null?void 0:g.trim();return d&&m.byTitle&&m.byTitle[d]?m.byTitle[d]:m.defaultSymbols||""},n=o=>o.split(";").map(l=>{const[c,...d]=l.split(":"),g=(c||"").trim(),f=d.join(":").trim();return g?{symbol:g,desc:f}:null}).filter(Boolean),p=o=>{const l=m.globalDefinitions||{},c=o.map(({symbol:d})=>{const g=l[d];return g?{symbol:d,desc:g}:null}).filter(Boolean);return c.length?c:o},b=o=>{const l=[],c=o.innerText||"",d=x=>{let N;for(;(N=x.exec(c))!==null;)l.push(N[1])};d(/\\begin\{equation\}([\s\S]*?)\\end\{equation\}/g),d(/\\\(([\\s\\S]*?)\\\)/g),d(/\\\[([\\s\\S]*?)\\\]/g);const g=new Set(["begin","end","frac","sqrt","left","right","cdot","ddot","dot","mathrm","mathit","text","sin","cos","tan","exp","log"]),f=[];return l.forEach(x=>{(x.match(/\\?[A-Za-z][A-Za-z0-9]*/g)||[]).forEach(N=>{const I=N.replace(/^\\/,"");!I||g.has(I)||f.includes(I)||f.push(I)})}),f.map(x=>({symbol:x,desc:""}))};r.forEach(o=>{if(o.classList.contains("Titlepage"))return;const l=o.dataset.symbols||"",c=e(o),d=l.trim()?n(l):c.trim()?n(c):p(b(o)),g=p(d);if(!g.length)return;o.classList.add("has-symbols");let f=o.querySelector(".symbol-column");f||(f=document.createElement("div"),f.className="symbol-column",o.appendChild(f)),f.innerHTML="";const x=document.createElement("div");x.className="symbol-column-title",x.textContent="Symbole",f.appendChild(x),g.forEach(({symbol:N,desc:I})=>{const _=document.createElement("div");_.className="symbol-row";const z=document.createElement("span");z.className="symbol",z.innerHTML=`\\(${N}\\)`;const D=document.createElement("span");D.className="desc",D.textContent=I||"",_.append(z,D),f.appendChild(_)}),t.push(f)}),t.length&&a&&a(t)}function ke({sheets:u}){const a=document.getElementById("fig-list"),r=document.getElementById("table-list");if(!a&&!r)return;const m={figure:[],table:[]};u.forEach(n=>{const p=Number(n.dataset.pageNumber);n.querySelectorAll("[data-figure]").forEach((b,o)=>{const l=(b.dataset.figure||b.getAttribute("data-figure")||"").trim();l&&m.figure.push({title:l,page:p,sheet:n,idx:o,node:b})}),n.querySelectorAll("[data-table]").forEach((b,o)=>{const l=(b.dataset.table||b.getAttribute("data-table")||"").trim();l&&m.table.push({title:l,page:p,sheet:n,idx:o,node:b})})});const t=(n,p,b)=>{if(n){if(n.innerHTML="",!p.length){const o=document.createElement("li");o.textContent="(keine Eintr√§ge markiert)",n.appendChild(o);return}p.sort((o,l)=>{const c=o.page-l.page;return c!==0?c:o.title.localeCompare(l.title)}),p.forEach((o,l)=>{var x;o.number=l+1;const c=document.createElement("li");c.className="toc-item",c.dataset.target=((x=o.sheet)==null?void 0:x.id)||"",c.setAttribute("role","button"),c.tabIndex=0;const d=document.createElement("span");d.className="toc-number",d.textContent=`${o.number}.`;const g=document.createElement("span");g.className="toc-title",g.textContent=o.title;const f=document.createElement("span");f.className="toc-page",f.textContent=o.page,c.append(d,g,f),n.appendChild(c)}),b==="figure"&&p.forEach(o=>{var g,f;const l=(g=o.node)==null?void 0:g.querySelector("figcaption");if(!l)return;const c=((f=l.querySelector("small"))==null?void 0:f.outerHTML)||"",d=`<strong>Abb. ${o.number}</strong>: ${o.title}`;l.innerHTML=c?`${d} ${c}`:d}),b==="table"&&p.forEach(o=>{var d;const l=(d=o.node)==null?void 0:d.closest("div.image-caption");if(!l)return;const c=`<strong>Tabelle ${o.number}</strong>: ${o.title}`;l.innerHTML=c})}};t(a,m.figure,"figure"),t(r,m.table,"table");const e=n=>{const p=n.target.closest(".toc-item[data-target]");if(!p)return;const b=p.dataset.target;if(!b)return;const o=document.getElementById(b);o&&(o.scrollIntoView({behavior:"smooth",block:"start"}),document.body.classList.remove("panel-open"))};a&&a.addEventListener("click",e),r&&r.addEventListener("click",e)}function Me(u,{ensureJSZip:a}){const{sheets:r,highlightColors:m,notesStorageKey:t}=u;let e=d(t),n=null,p=null,b=null,o=null,l=null,c=!1;e.docId=e.docId||Q(),e.sheetMeta=Array.isArray(e.sheetMeta)?e.sheetMeta:[];function d(s){try{const i=localStorage.getItem(s);if(!i)return{notes:{},highlights:{}};const h=JSON.parse(i);return{notes:h.notes||{},highlights:h.highlights||{},docId:h.docId,sheetMeta:h.sheetMeta||[]}}catch(i){return console.warn("Notes load failed",i),{notes:{},highlights:{}}}}function g(){try{e.docId||(e.docId=Q()),Array.isArray(e.sheetMeta)||(e.sheetMeta=[]),localStorage.setItem(t,JSON.stringify(e))}catch(s){console.warn("Notes save failed",s)}}function f(){e.notes=e.notes||{},e.highlights=e.highlights||{},e.sheetMeta=te(),g(),r.forEach((s,i)=>{if(s.classList.contains("Titlepage"))return;const h=s.id||`sheet-${i+1}`,E=e.notes[h]||"";let C=s.querySelector(".sheet-notes");C||(C=document.createElement("div"),C.className="sheet-notes",C.innerHTML=`
          <div class="sheet-notes__title"></div>
          <textarea class="sheet-notes__area" aria-label="Notizen"></textarea>
          <div class="sheet-notes__highlights"></div>
        `,s.appendChild(C));const T=C.querySelector(".sheet-notes__title");T&&(T.textContent=`Notizen zu Seite ${s.dataset.pageNumber||i+1}`);const $=C.querySelector(".sheet-notes__area");$&&($.value=E,$.addEventListener("input",()=>{e.notes[h]=$.value,g()})),I(s,h)}),ie()}function x(s,i){e.highlights[i]=[],s.querySelectorAll(".highlight-note").forEach(h=>D(h)),g()}function N(s,i,h,E,C){const T=(h.toString()||"").trim();if(!T)return;const $={id:`${Date.now()}-${Math.random().toString(16).slice(2,8)}`,text:T,comment:E||"",color:m.includes(C)?C:"yellow"};if(!_(s,$,h))return;const k=e.highlights[i]||[];k.push($),e.highlights[i]=k,g(),w(),M()}function I(s,i){(e.highlights&&e.highlights[i]||[]).forEach(E=>{_(s,E)})}function _(s,i,h=null){if(!i||!i.text||s.querySelector(`[data-hl-id="${i.id}"]`))return null;let E=h;if(!E){const $=j(s,i.text);if(!$)return null;E=$.range}const C=E.extractContents(),T=document.createElement("span");return T.className="highlight-note",T.dataset.hlId=i.id,T.dataset.hlColor=m.includes(i.color)?i.color:"yellow",T.title=i.comment||"Kommentar",T.appendChild(C),E.insertNode(T),T.addEventListener("click",$=>{$.stopPropagation(),s.classList.add("notes-open"),R(E,s,s.id||"",i)}),T}function z(s){var E,C,T,$;const i=((E=s.commonAncestorContainer)==null?void 0:E.nodeType)===1?s.commonAncestorContainer:(C=s.commonAncestorContainer)==null?void 0:C.parentElement,h=(T=i==null?void 0:i.closest)==null?void 0:T.call(i,".highlight-note");return(($=h==null?void 0:h.dataset)==null?void 0:$.hlId)||""}function D(s){const i=s.parentNode;if(!i)return;const h=document.createDocumentFragment();for(;s.firstChild;)h.appendChild(s.firstChild);i.replaceChild(h,s),i.normalize()}function L(s){Object.keys(e.highlights||{}).forEach(i=>{e.highlights[i]=(e.highlights[i]||[]).filter(h=>h.id!==s)}),document.querySelectorAll(`.highlight-note[data-hl-id="${s}"]`).forEach(i=>D(i)),g()}function y(){document.addEventListener("selectionchange",A),document.addEventListener("mouseup",()=>{A(),S()}),document.addEventListener("keyup",A),document.addEventListener("contextmenu",s=>{const i=s.target.closest(".sheet");if(!i)return;const h=q(i);if(!h)return;s.preventDefault();const E=z(h.range);b={sheet:h.sheet,sheetId:h.sheetId,range:h.range,highlightId:E},v(s.clientX,s.clientY)}),document.addEventListener("click",s=>{if(c){c=!1;return}n&&(n.contains(s.target)||w())}),document.addEventListener("keydown",s=>{s.key==="Escape"&&(w(),M())})}function v(s,i){w({keepPending:!0}),n=document.createElement("div"),n.className="highlight-menu";const h=document.createElement("button");h.type="button",h.textContent="Highlight + Notiz",h.addEventListener("click",()=>{const $=b;w(),$&&R($.range,$.sheet,$.sheetId)}),n.appendChild(h);const E=document.createElement("button");if(E.type="button",E.textContent="Text kopieren",E.addEventListener("click",()=>{var k,O;const $=b;if(!$)return;const K=(((k=$.range)==null?void 0:k.toString())||"").trim();K&&((O=navigator.clipboard)==null||O.writeText(K).catch(()=>{})),w()}),n.appendChild(E),b!=null&&b.highlightId){const $=document.createElement("button");$.type="button",$.textContent="üóëÔ∏è",$.title="Highlight l√∂schen",$.addEventListener("click",()=>{L(b.highlightId),w()}),n.appendChild($)}document.body.appendChild(n);const C=i+window.scrollY+6,T=s+window.scrollX+6;n.style.top=`${C}px`,n.style.left=`${T}px`,c=!0}function w(s={}){const{keepPending:i=!1}=s;n&&(n.remove(),n=null),i||(b=null)}function S(){var k,O;if(n||p)return;const s=window.getSelection();if(!s||s.isCollapsed)return;const i=s.getRangeAt(0).cloneRange(),h=i.commonAncestorContainer.nodeType===1?i.commonAncestorContainer:i.commonAncestorContainer.parentElement;if((k=h==null?void 0:h.closest)!=null&&k.call(h,".sheet-notes"))return;const E=(O=h==null?void 0:h.closest)==null?void 0:O.call(h,".sheet");if(!E)return;const C=z(i);b={sheet:E,sheetId:E.id||"",range:i,highlightId:C};const T=i.getBoundingClientRect(),$=T.right,K=T.bottom;v($,K)}function R(s,i,h,E=null){M(),h||(h=i.id||""),p=document.createElement("div"),p.className="highlight-create",p.innerHTML=`
      <div style="display:flex; align-items:center; justify-content:space-between; gap:6px;">
        <div style="font-size:11px; font-weight:700;">Kommentar hinzuf√ºgen</div>
        <button type="button" class="hlc-close" aria-label="Schlie√üen">‚úï</button>
      </div>
      <div style="font-size:11px; margin:2mm 0; color:#555;">${(s.toString()||"").slice(0,120)}</div>
      <div class="hlc-color-row">
        ${m.map(W=>`<button type="button" class="hlc-color-btn" data-color="${W}" title="${W}" aria-label="Farbe ${W}"></button>`).join("")}
      </div>
      <textarea class="hlc-text" aria-label="Kommentar" placeholder="Kommentar (optional)"></textarea>
      <div class="highlight-editor__actions">
        <button type="button" class="hl-save">Speichern</button>
        ${E?'<button type="button" class="hl-delete" title="Highlight l√∂schen">üóëÔ∏è</button>':""}
        <button type="button" class="hl-cancel">Abbrechen</button>
      </div>
    `,document.body.appendChild(p);const C=s.getBoundingClientRect(),T=p.getBoundingClientRect();let $=C.bottom+window.scrollY+8,K=C.left+window.scrollX;K=Math.min(K,window.scrollX+window.innerWidth-T.width-8),$=Math.max(8+window.scrollY,$),p.style.top=`${$}px`,p.style.left=`${K}px`;const k=p.querySelector(".hlc-text"),O=Array.from(p.querySelectorAll(".hlc-color-btn"));let U=E&&m.includes(E.color)?E.color:"yellow";const J=()=>{O.forEach(W=>{const se=W.dataset.color;W.classList.toggle("is-selected",se===U)})};J(),O.forEach(W=>{W.addEventListener("click",()=>{U=W.dataset.color,J()})}),E&&(k.value=E.comment||"");const X=p.querySelector(".hl-save"),ee=p.querySelector(".hl-delete"),ae=p.querySelector(".hl-cancel"),me=p.querySelector(".hlc-close"),de=()=>M();X==null||X.addEventListener("click",()=>{const W=k.value.trim(),se=U;if(E){E.comment=W,E.color=m.includes(se)?se:"yellow";const pe=i.querySelector(`.highlight-note[data-hl-id="${E.id}"]`);pe&&(pe.title=W||"Kommentar",pe.dataset.hlColor=E.color),g()}else N(i,h,s,W,se);de()}),ee==null||ee.addEventListener("click",()=>{E&&(L(E.id),de())}),ae==null||ae.addEventListener("click",de),me==null||me.addEventListener("click",de)}function M(){p&&(p.remove(),p=null)}function A(){var C,T;const s=window.getSelection();if(!s||s.isCollapsed)return;const i=s.getRangeAt(0),h=(T=(C=i.commonAncestorContainer.nodeType===1?i.commonAncestorContainer:i.commonAncestorContainer.parentElement)==null?void 0:C.closest)==null?void 0:T.call(C,".sheet");if(!h)return;const E=i.getBoundingClientRect();o={range:i.cloneRange(),sheet:h,sheetId:h.id||""},l=E}function q(s){const i=window.getSelection();if(i&&!i.isCollapsed){const h=i.getRangeAt(0).cloneRange();if(s.contains(h.commonAncestorContainer))return{range:h,sheet:s,sheetId:s.id||""}}return o&&o.sheet===s?{range:o.range.cloneRange(),sheet:s,sheetId:o.sheetId||s.id||"",rect:l}:null}function j(s,i){if(!i)return null;const h=document.createTreeWalker(s,NodeFilter.SHOW_TEXT,{acceptNode:C=>!C.parentElement||C.parentElement.closest(".sheet-notes, .highlight-note")?NodeFilter.FILTER_REJECT:!C.data||!C.data.trim()?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT});let E;for(;E=h.nextNode();){const C=E.data.indexOf(i);if(C!==-1){const T=document.createRange();return T.setStart(E,C),T.setEnd(E,C+i.length),{range:T}}}return null}function P(){const s=document.getElementById("notes-export");s&&s.addEventListener("click",()=>{H().catch(i=>console.error("Notes export failed",i))})}async function H(){e.docId=e.docId||Q(),e.sheetMeta=te();const s=JSON.stringify(e,null,2),i=`<!DOCTYPE html>
`+document.documentElement.outerHTML,h=(E,C)=>{const T=document.createElement("a");T.href=URL.createObjectURL(C),T.download=E,document.body.appendChild(T),T.click(),T.remove(),URL.revokeObjectURL(T.href)};try{if(await a(),!window.JSZip)throw new Error("JSZip unavailable");const E=new JSZip;E.file("notes.json",s),E.file("document.html",i);const C=await E.generateAsync({type:"blob"});h("notes_bundle.zip",C)}catch(E){console.warn("Zip export failed, falling back to JSON",E),h("notes.json",new Blob([s],{type:"application/json"}))}}function V(){const s=document.getElementById("notes-import");if(!s)return;const i=document.createElement("input");i.type="file",i.accept=".json,.zip,application/json,application/zip",i.style.display="none",i.addEventListener("change",()=>{var E;const h=(E=i.files)==null?void 0:E[0];h&&(B(h).catch(C=>console.warn("Import failed",C)),i.value="")}),document.body.appendChild(i),s.addEventListener("click",async()=>{if(!G()){i.click();return}const h=await le();h!=="cancel"&&(h==="export-import"&&await H().catch(E=>console.error("Notes export failed",E)),i.click())})}function Z(s=[]){const i=te(),h=new Map,E=new Map;i.forEach(k=>{k.slug&&h.set(k.slug,k),k.id&&E.set(k.id,k)});const C=(k,O)=>{if(k!=null&&k.slug&&h.has(k.slug))return h.get(k.slug);if(k!=null&&k.title){const U=i.find(J=>J.title===k.title);if(U)return U}return O&&E.has(O)?E.get(O):null},T=new Map;s.forEach(k=>T.set(k.id,k));const $={},K={};Object.entries(e.notes||{}).forEach(([k,O])=>{const U=T.get(k),J=C(U,k),X=(J==null?void 0:J.id)||k,ae=J&&U&&U.hash&&U.hash!==J.hash?`[Warnung] Seiteninhalt hat sich seit dem Export ge√§ndert. Bitte pr√ºfen.

`:"";$[X]=ae+(O||"")}),Object.entries(e.highlights||{}).forEach(([k,O])=>{const U=T.get(k),J=C(U,k),X=(J==null?void 0:J.id)||k;K[X]=Array.isArray(O)?O.slice():[]}),e.notes=$,e.highlights=K,e.sheetMeta=i,g(),r.forEach((k,O)=>{var ee;if(k.classList.contains("Titlepage"))return;const U=k.id||`sheet-${O+1}`,J=k.querySelector(".sheet-notes"),X=J==null?void 0:J.querySelector(".sheet-notes__area");X&&(X.value=((ee=e.notes)==null?void 0:ee[U])||""),x(k,U),I(k,U)})}return{initSheetNotes:f,initNoteExport:P,initNoteImport:V,initHighlightContextMenu:y};function G(){const s=Object.values(e.notes||{}),i=Object.values(e.highlights||{}),h=s.some(C=>(C||"").trim().length>0),E=i.some(C=>Array.isArray(C)&&C.length>0);return h||E}async function B(s){if((s.name||"").toLowerCase().endsWith(".zip")){await Y(s);return}const h=await s.text();ne(h)}async function Y(s){if(await a(),!window.JSZip)throw new Error("JSZip unavailable for import");const i=await s.arrayBuffer(),h=await window.JSZip.loadAsync(i);let E=h.file(/notes\.json$/i)[0]||h.file(/\.json$/i)[0];if(!E)throw new Error("notes.json not found in zip");const C=await E.async("string");ne(C)}function ne(s){const i=JSON.parse(s||"{}");e={docId:i.docId||Q(),sheetMeta:Array.isArray(i.sheetMeta)?i.sheetMeta:[],notes:i.notes||{},highlights:i.highlights||{}},g(),Z(i.sheetMeta||[])}function le(){return new Promise(s=>{const i=document.createElement("div");i.className="notes-import-modal";const h=document.createElement("div");h.className="notes-import-dialog",h.innerHTML=`
        <h3 class="notes-import-title">Vorhandene Notizen gefunden</h3>
        <p class="notes-import-text">Beim Import werden aktuelle Notizen und Highlights ersetzt. M√∂chtest du vorher exportieren?</p>
        <div class="notes-import-actions">
          <button type="button" data-action="export-import" class="primary">Exportieren &amp; importieren</button>
          <button type="button" data-action="import">Nur importieren</button>
          <button type="button" data-action="cancel" class="ghost">Abbrechen</button>
        </div>
      `,i.appendChild(h),document.body.appendChild(i);const E=T=>{i.remove(),document.removeEventListener("keydown",C),s(T)},C=T=>{T.key==="Escape"&&E("cancel")};document.addEventListener("keydown",C),i.addEventListener("click",T=>{T.target===i&&E("cancel")}),h.querySelectorAll("button[data-action]").forEach(T=>{T.addEventListener("click",()=>E(T.dataset.action))})})}function te(){return r.filter(s=>!s.classList.contains("Titlepage")).map(s=>{var h,E;const i={id:s.id||"",slug:s.dataset.linkSlug||re(s.dataset.link||s.id||""),title:((E=(h=s.querySelector("[data-toc]"))==null?void 0:h.dataset)==null?void 0:E.toc)||s.id||""};return i.hash=ue(oe(s)),i})}function oe(s){const i=document.createTreeWalker(s,NodeFilter.SHOW_TEXT,{acceptNode:C=>!C.parentElement||C.parentElement.closest(".sheet-notes")?NodeFilter.FILTER_REJECT:!C.data||!C.data.trim()?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT});let h="",E;for(;E=i.nextNode();)h+=E.data+" ";return h.replace(/\s+/g," ").trim()}function ue(s){let i=0;for(let h=0;h<s.length;h+=1)i=i*31+s.charCodeAt(h)|0;return`h${(i>>>0).toString(16)}`}function re(s){return(s||"").toString().trim().toLowerCase().replace(/['"()]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}function Q(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`doc-${Date.now().toString(36)}-${Math.random().toString(16).slice(2,8)}`}function ie(){const s=document.getElementById("notes-toggle-all");if(!s)return;let i=!1;const h=()=>{s.textContent=i?"Alle Notizen schlie√üen":"Alle Notizen √∂ffnen"};h(),s.addEventListener("click",()=>{i=!i,r.forEach((E,C)=>{E.classList.contains("Titlepage")||E.classList.toggle("notes-open",i)}),h()})}}function qe(u){const{sheetAudio:a,audioRegistry:r,body:m,sheets:t,audioDefaults:e}=u;let n=(m.dataset.audioMode||e.mode||"manual").toLowerCase(),p=I(parseFloat(localStorage.getItem("sheetAudioVolume"))||1);const b=(()=>{let L=null;return()=>{L||(L=requestAnimationFrame(()=>{L=null,N()}))}})();function o(){l(),d(),a.length=0,t.forEach(y=>{var S;const v=(y.dataset.audioSrc||"").trim();if(!v)return;const w=(y.dataset.audioTitle||((S=y.querySelector("[data-toc]"))==null?void 0:S.textContent)||"Audio").trim();a.push({sheet:y,src:v,title:w})});const L=Array.from(document.querySelectorAll('input[name="audio-mode"]'));if(L.length){const y=(localStorage.getItem("sheetAudioMode")||"").toLowerCase();y==="manual"||y==="autoplay"?n=y:(n="manual",localStorage.setItem("sheetAudioMode",n)),L.forEach(v=>{v.checked=v.value.toLowerCase()===n,v.addEventListener("change",w=>{n=(w.target.value||"manual").toLowerCase(),localStorage.setItem("sheetAudioMode",n),g()})})}g(),z()}function l(){if(m.dataset.audioExclusiveBound==="true")return;m.dataset.audioExclusiveBound="true";const L=y=>{const v=y.target;!v||v.tagName!=="AUDIO"||(c(v),requestAnimationFrame(()=>c(v)))};document.addEventListener("play",L,!0),document.addEventListener("playing",L,!0)}function c(L){r.forEach(({audio:y})=>{y&&y!==L&&y.pause()}),document.querySelectorAll("audio").forEach(y=>{if(y!==L)try{y.pause()}catch{}})}function d(){m.dataset.audioFooterToggleBound!=="true"&&(m.dataset.audioFooterToggleBound="true",document.addEventListener("click",L=>{var S,R;const y=(R=(S=L.target)==null?void 0:S.closest)==null?void 0:R.call(S,".page-footer__title");if(!y)return;const v=y.closest(".page-footer");if(!v)return;const w=v.querySelector("audio.sheet-audio__hidden");w&&(L.preventDefault(),L.stopPropagation(),w.paused?(c(w),w.play().catch(()=>{})):w.pause())},!0))}function g(){if(r.forEach(({audio:y})=>y.pause()),r.length=0,document.querySelectorAll(".sheet-audio").forEach(y=>y.remove()),document.querySelectorAll(".sheet-audio__progress").forEach(y=>y.remove()),document.querySelectorAll(".sheet-audio__scrubber").forEach(y=>y.remove()),document.querySelectorAll(".page-footer.has-audio").forEach(y=>{var v;y.classList.remove("has-audio"),y.style.setProperty("--audio-progress","0%"),(v=y.querySelector(".page-footer__title"))==null||v.classList.remove("is-playing")}),n==="off")return;const L=(y,v)=>{y.classList.add("has-audio");const w=document.createElement("div");w.className="sheet-audio sheet-audio--footer";const S=document.createElement("audio");S.preload="metadata",S.src=v.src,S.setAttribute("title",v.title),S.className="sheet-audio__hidden",D(S);const R=document.createElement("div");R.className="sheet-audio__progress",y.prepend(R);const M=document.createElement("input");M.type="range",M.className="sheet-audio__scrubber",M.min="0",M.max="100",M.step="0.1",M.value="0",y.prepend(M);let A=!1;const q=y.querySelector(".page-footer__title"),j=()=>{if(!S.duration||Number.isNaN(S.duration))return;const B=Math.min(100,Math.max(0,S.currentTime/S.duration*100));y.style.setProperty("--audio-progress",`${B}%`),A||(M.value=`${B}`)},P=()=>{q&&(S.paused?q.classList.remove("is-playing"):q.classList.add("is-playing"))};S.addEventListener("timeupdate",j),S.addEventListener("loadedmetadata",j),S.addEventListener("loadedmetadata",()=>D(S)),S.addEventListener("ended",()=>{y.style.setProperty("--audio-progress","0%"),P()}),S.addEventListener("play",()=>{c(S),P()}),S.addEventListener("pause",P),S.addEventListener("play",()=>D(S));const H=B=>{const Y=R.getBoundingClientRect();return Y.width?(B-Y.left)/Y.width:0},V=B=>{if(!S.duration||Number.isNaN(S.duration))return;const Y=Math.min(1,Math.max(0,B));S.currentTime=Y*S.duration,y.style.setProperty("--audio-progress",`${Y*100}%`),M.value=`${Y*100}`};M.addEventListener("pointerdown",B=>{!S.duration||Number.isNaN(S.duration)||(A=!0,B.pointerId!==void 0&&M.setPointerCapture(B.pointerId),V(H(B.clientX)))}),M.addEventListener("pointermove",B=>{A&&V(H(B.clientX))});const Z=B=>{A&&(A=!1,B.pointerId!==void 0&&M.hasPointerCapture(B.pointerId)&&M.releasePointerCapture(B.pointerId))};M.addEventListener("pointerup",Z),M.addEventListener("pointercancel",Z),M.addEventListener("input",B=>{if(!S.duration||Number.isNaN(S.duration))return;const Y=Math.min(100,Math.max(0,parseFloat(B.target.value)||0))/100;V(Y)}),w.append(S),y.appendChild(w);const G=y.closest(".sub-page-sheet")||y.closest(".sheet");r.push({audio:S,container:G}),P()};a.forEach(y=>{const v=[],w=y.sheet.querySelector(":scope > .page-footer")||y.sheet.querySelector(".page-footer");w&&v.push(w),y.sheet.querySelectorAll(":scope .sub-page-sheet .page-footer").forEach(S=>v.push(S)),v.forEach(S=>L(S,y))}),z(),n==="autoplay"?N():b()}function f(L){const y=r.filter(({container:w})=>w==null?void 0:w.closest("#subsheet-content")),v=r.filter(({container:w})=>!(w!=null&&w.closest("#subsheet-content")));return L&&y.length?y:!L&&v.length?v:y.length?y:v}function x(){const L=document.body.classList.contains("panel-open");let y={x:window.innerWidth/2,y:window.innerHeight/2};if(L){const M=document.getElementById("subsheet-content"),A=M==null?void 0:M.getBoundingClientRect();A&&(y={x:A.left+A.width/2,y:A.top+A.height/2})}const v=f(L);if(!v.length)return null;let w=null,S=1/0,R=!1;return v.forEach(M=>{var V;const A=(V=M.container)==null?void 0:V.getBoundingClientRect();if(!A)return;const q=y.x>=A.left&&y.x<=A.right&&y.y>=A.top&&y.y<=A.bottom,j=A.left+A.width/2,P=A.top+A.height/2,H=Math.hypot(j-y.x,P-y.y);if(q&&!R){w=M,S=H,R=!0;return}if(q&&H<S){w=M,S=H;return}!R&&H<S&&(w=M,S=H)}),(w==null?void 0:w.audio)||null}function N(){if(n!=="autoplay")return;const L=x();L&&c(L),n==="autoplay"&&L&&L.play().catch(()=>{})}function I(L){return Number.isFinite(L)?Math.min(1,Math.max(0,L)):1}function _(){const L=document.getElementById("audio-volume");if(!L)return;L.value=String(p);const y=()=>{const v=Number.isFinite(L.valueAsNumber)?L.valueAsNumber:parseFloat(L.value),w=I(v);p=w,localStorage.setItem("sheetAudioVolume",String(w)),z()};L.addEventListener("input",y),L.addEventListener("change",y)}return{initAudioControls:o,renderSheetAudio:g,requestAudioUpdate:b,updateAutoplayFocus:N,bindVolumeControl:_};function z(){r.forEach(({audio:L})=>D(L))}function D(L){if(L)try{const y=I(p);L.muted=y===0,L.volume=y}catch{}}}function $e(u){const{videoEntries:a}=u;let r;function m(){return window.YT&&window.YT.Player?Promise.resolve():r||(r=new Promise(c=>{const d=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{d==null||d(),c()};const g=document.createElement("script");g.src="https://www.youtube.com/iframe_api",g.async=!0,document.head.appendChild(g)}),r)}function t(){const c=Array.from(document.querySelectorAll(".video-entry[data-video-id]"));c.length&&c.forEach((d,g)=>{var w,S;const f=d.closest(".sheet"),x=Number((f==null?void 0:f.dataset.pageNumber)||g+1),N=a.length+1,I=(d.dataset.videoId||"").trim();if(!I)return;const _=(d.dataset.videoTitle||((w=d.querySelector("figcaption"))==null?void 0:w.textContent)||`Video ${g+1}`).trim(),z=(d.dataset.videoCaption||((S=d.querySelector("figcaption"))==null?void 0:S.textContent)||"").trim(),D=`https://www.youtube-nocookie.com/embed/${I}`,L=`https://youtu.be/${I}`;let y=d.querySelector(".video-frame");y||(y=document.createElement("div"),y.className="video-frame",d.prepend(y)),y.innerHTML="",y.appendChild(o({url:D,title:_,shareUrl:L,iframeId:`yt-embed-${I}-${N}`})),y.appendChild(b(L,_));let v=d.querySelector("figcaption");v||(v=document.createElement("figcaption"),d.appendChild(v)),v.textContent=`Video ${N}: ${z||_}`,a.push({title:_,caption:z,videoId:I,url:D,shareUrl:L,sheet:f,page:x,idx:g,number:N})})}function e(){const c=document.getElementById("video-list");if(c){if(c.innerHTML="",!a.length){const d=document.createElement("li");d.textContent="(keine Videos markiert)",c.appendChild(d);return}a.forEach(d=>{var I;const g=document.createElement("li");g.className="toc-item",g.dataset.target=((I=d.sheet)==null?void 0:I.id)||"",g.setAttribute("role","button"),g.tabIndex=0;const f=document.createElement("span");f.className="toc-number",f.textContent=`${d.number}.`;const x=document.createElement("span");x.className="toc-title",x.textContent=`Video ${d.number}: ${d.title}`;const N=document.createElement("span");N.className="toc-page",N.textContent=d.page,g.append(f,x,N),c.appendChild(g)}),c.addEventListener("click",d=>{const g=d.target.closest(".toc-item[data-target]");if(!g)return;const f=g.dataset.target;if(!f)return;const x=document.getElementById(f);x&&(x.scrollIntoView({behavior:"smooth",block:"start"}),document.body.classList.remove("panel-open"))})}}function n(c,d,g){const f=document.createElement("iframe"),x=c.includes("?")?"&":"?";return f.src=`${c}${x}enablejsapi=1&rel=0&playsinline=1`,f.title=d||"YouTube Video",f.loading="lazy",f.allowFullscreen=!0,f.referrerPolicy="strict-origin-when-cross-origin",g&&(f.id=g),f}function p(c){const d=document.createElement("div");return d.className="video-embed",d.appendChild(c),d}function b(c,d){const g=document.createElement("img");g.alt=d||"Video QR",g.className="video-qr";const f=encodeURIComponent(c);g.src=`https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${f}`;const x=document.createElement("div");x.className="video-qr-wrapper",x.appendChild(g);const N=document.createElement("div");N.className="video-qr-caption";const I=document.createElement("a");return I.href=c,I.target="_blank",I.rel="noreferrer noopener",I.textContent=c,N.appendChild(I),x.appendChild(N),x}return{initVideos:t,buildVideoList:e,buildVideoIframe:n,buildVideoQr:b};function o({url:c,title:d,shareUrl:g,iframeId:f}){const x=document.createElement("div");x.className="video-embed video-embed--placeholder";const N=document.createElement("div");N.className="video-placeholder";const I=document.createElement("div");I.className="video-placeholder__info",I.textContent=d||"Video";const _=document.createElement("button");return _.type="button",_.className="video-placeholder__btn",_.textContent="Youtube Video Anzeigen",_.addEventListener("click",()=>{const z=n(c,d,f);x.replaceWith(p(z)),l(z)}),N.append(I,_),x.appendChild(N),x}function l(c){c&&m().then(()=>{var d;(d=window.YT)!=null&&d.Player&&new window.YT.Player(c,{host:"https://www.youtube-nocookie.com",playerVars:{rel:0,playsinline:1,modestbranding:1},events:{onStateChange:g=>{if(g.data===window.YT.PlayerState.ENDED)try{g.target.stopVideo()}catch{}}}})}).catch(()=>{})}}function _e(){const u=Array.from(document.querySelectorAll(".python-script-block"));if(!u.length)return;const a=m=>{if(!m)return;const t=m.textContent||m.innerText||"",e=b=>b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),n=[{type:"comment",regex:/#[^\n]*/g},{type:"string",regex:/(\"\"\"[\s\S]*?\"\"\"|'''[\s\S]*?'''|"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*')/g},{type:"number",regex:/\b\d+(?:\.\d+)?\b/g},{type:"keyword",regex:/\b(and|as|assert|async|await|break|class|continue|def|del|elif|else|except|False|finally|for|from|global|if|import|in|is|lambda|None|nonlocal|not|or|pass|raise|return|True|try|while|with|yield)\b/g},{type:"builtin",regex:/\b(print|len|range|enumerate|dict|list|set|tuple|float|int|str|Path|open|sum|min|max|zip|map|filter|all|any|sorted)\b/g}];let p=e(t);n.forEach(({type:b,regex:o})=>{p=p.replace(o,l=>`<span class="code-token ${b}">${e(l)}</span>`)}),m.innerHTML=p},r=async m=>{try{return await navigator.clipboard.writeText(m),!0}catch{try{const e=document.createElement("textarea");e.value=m,e.style.position="fixed",e.style.top="-500px",document.body.appendChild(e),e.focus(),e.select();const n=document.execCommand("copy");return e.remove(),n}catch(e){return console.warn("Copy failed",e),!1}}};u.forEach(m=>{const t=m.querySelector(".code-full"),e=m.querySelector(".code-preview");if(!t)return;const n=(t.textContent||"").trim();if(!n)return;a(t.querySelector("code")||t),e&&a(e.querySelector("code")||e);const p=document.createElement("div");p.className="code-actions";const b=document.createElement("button");b.type="button",b.textContent="Ganzes Skript kopieren",b.addEventListener("click",async()=>{const g=await r(n)?"Kopiert!":"Kopieren fehlgeschlagen",f=b.textContent;b.textContent=g,setTimeout(()=>{b.textContent=f},1800)});let o=!1;const l=document.createElement("button");l.type="button",l.className="secondary";const c=()=>{t.hidden=!o,t.classList.toggle("is-expanded",o),m.classList.toggle("is-expanded",o),l.textContent=o?"Vollst√§ndiges Skript ausblenden":"Vollst√§ndiges Skript anzeigen";const d=m.closest(".sheet");d&&d.classList.toggle("is-code-expanded",o)};c(),l.addEventListener("click",()=>{o=!o,c()}),p.append(b,l),m.appendChild(p)})}function Be(u){const{body:a}=u,r=Array.from(document.querySelectorAll('input[name="theme-mode"]'));let t=(localStorage.getItem("sheetTheme")||"").toLowerCase()==="dark"?"dark":"light";const e=(b,o=!0)=>{const l=b==="dark"?"dark":"light";t=l,window.sheetThemeMode=l,a.classList.toggle("theme-dark",l==="dark"),a.classList.toggle("theme-light",l==="light"),document.documentElement.setAttribute("data-theme",l),r.forEach(c=>{c.checked=(c.value||"").toLowerCase()===l}),o&&localStorage.setItem("sheetTheme",l)};e(t,!1),r.forEach(b=>{b.addEventListener("change",o=>{const l=(o.target.value||"light").toLowerCase();e(l)})});const n=()=>{a.dataset.prevTheme=t,e("light",!1)},p=()=>{const b=a.dataset.prevTheme||t||"light";e(b,!1)};window.addEventListener("beforeprint",n),window.addEventListener("afterprint",p)}function Pe(u,{ensureJSZip:a}){const{sheets:r,body:m}=u,t=document.getElementById("print-confirm"),e=document.getElementById("print-save"),n=document.getElementById("print-include-subsheets-yes"),p=document.getElementById("print-include-subsheets-no"),b=document.getElementById("print-include-fullcode"),o=document.getElementById("print-include-fullcode-main"),l=document.getElementById("print-modal"),c=document.getElementById("print-include-subsheets");if(!t||!e)return;const d=new Date().toISOString().slice(0,10);let g=[];const f=()=>n&&!p?n.checked||n.hasAttribute("checked"):n&&p?n.checked||!n.checked&&!p.checked&&n.hasAttribute("checked"):c?c.checked:!0,x=()=>!!(b&&b.checked||o&&o.checked),N=()=>{g.forEach(v=>v.remove()),g=[]},I=()=>{N(),r.forEach(v=>{const w=Array.from(v.querySelectorAll(".sub-page-sheet"));if(!w.length)return;const S=document.createElement("div");S.className="print-subpages",v.id&&(S.dataset.printSourceSheetId=v.id),w.forEach(R=>S.appendChild(R.cloneNode(!0))),v.insertAdjacentElement("afterend",S),g.push(S)})},_=()=>{const v=new Map,w=new Map,S=45;document.querySelectorAll(".code-full").forEach(R=>{const M=(R.textContent||"").trim();if(!M)return;const A=R.closest(".sheet");if(!A)return;const q=R.closest(".sub-page-sheet"),j=A.id||A.dataset.pageNumber||`sheet-${w.size+1}`;let P=(w.get(j)||0)+1;const H=(Z,G)=>{var s,i;const B=document.createElement("section");B.className="sheet libertinus padding-20mm code-print-sheet";const Y=q&&q.querySelector(".page-header")||A.querySelector(":scope > .page-header");if(Y){const h=Y.cloneNode(!0);B.appendChild(h)}const ne=document.createElement("article");ne.innerHTML="<strong>Code (vollst√§ndig)</strong>",B.appendChild(ne);const le=document.createElement("pre"),te=document.createElement("code");te.textContent=Z,le.appendChild(te),B.appendChild(le);const oe=document.createElement("div");oe.className="page-footer";const ue=((s=A.querySelector(".page-footer__title"))==null?void 0:s.textContent)||((i=A.querySelector(":scope > .page-header"))==null?void 0:i.textContent)||"Code",re=document.createElement("span");re.className="page-footer__title",re.textContent=ue;const Q=document.createElement("span");Q.className="code-page-number",Q.textContent=`c${G}`,oe.append(re,Q),B.appendChild(oe);let ie=v.get(A);ie||(ie=g.slice().reverse().find(h=>{var E;return A.id&&((E=h.dataset)==null?void 0:E.printSourceSheetId)===A.id})||A),ie.insertAdjacentElement("afterend",B),v.set(A,B),g.push(B)},V=M.split(/\r?\n/);for(let Z=0;Z<V.length;Z+=S){const G=V.slice(Z,Z+S).join(`
`);H(G,P),P+=1}w.set(j,P-1)})};t.addEventListener("click",()=>{f()?I():N(),x()&&_(),l==null||l.setAttribute("hidden","true"),window.print()});const z=async v=>{const w=async A=>(await fetch(A)).text(),S=async(A,q)=>{const j=/@import\\s+url\\(([^)]+)\\)\\s*;?/g;let P,H=A;for(;(P=j.exec(A))!==null;){const V=P[1].replace(/['"]/g,"").trim();if(V)try{const Z=V.startsWith("http")?V:new URL(V,q).toString(),G=await w(Z);H=H.replace(P[0],G)}catch(Z){console.warn("Inline @import failed for",V,Z)}}return H},R=Array.from(v.querySelectorAll('link[rel="stylesheet"]'));for(const A of R){const q=A.getAttribute("href")||"";try{const j=q.startsWith("http")?q:new URL(q,document.baseURI).toString(),P=await w(j),H=await S(P,j),V=v.createElement("style");V.textContent=H,A.replaceWith(V)}catch(j){console.warn("Inline CSS failed for",q,j)}}const M=Array.from(v.querySelectorAll("script[src]"));for(const A of M){const q=A.getAttribute("src")||"";if(!q.toLowerCase().includes("mathjax"))try{const j=q.startsWith("http")?q:new URL(q,document.baseURI).toString(),P=await w(j),H=v.createElement("script");H.textContent=P,A.replaceWith(H)}catch(j){console.warn("Inline JS failed for",q,j)}}},D=async(v,w)=>{const S=Array.from(w.querySelectorAll("script[src*='mathjax']"));if(!S.length)return;S.forEach(M=>M.setAttribute("src","mathjax.js"));const R=[m.dataset.mathjaxSrc||"node_modules/mathjax/es5/tex-mml-chtml.js","https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"];for(const M of R)try{const A=M.startsWith("http")?M:new URL(M,document.baseURI).toString(),q=await fetch(A);if(!q.ok)continue;const j=await q.text();v.file("mathjax.js",j);return}catch{continue}},L=async()=>{var A;f()?I():N(),x()&&_();const w=document.documentElement.cloneNode(!0);(A=w.querySelector("body"))==null||A.classList.add("offline-export");try{await z(w)}catch(q){console.warn("Inline assets failed",q)}const S="<!DOCTYPE html>\\n"+w.outerHTML,R=(q,j)=>{const P=document.createElement("a");P.href=URL.createObjectURL(j),P.download=q,document.body.appendChild(P),P.click(),P.remove(),URL.revokeObjectURL(P.href)},M=()=>R("document.html",new Blob([S],{type:"text/html"}));try{if(await Promise.race([a(),new Promise((P,H)=>setTimeout(()=>H(new Error("JSZip timeout")),3e3))]),!window.JSZip)throw new Error("JSZip unavailable");const q=new JSZip;q.file("document.html",S),await D(q,w);const j=await q.generateAsync({type:"blob"});R("document.zip",j)}catch(q){console.warn("Zip export failed, falling back to HTML",q),M()}document.body.classList.remove("offline-export"),N(),y()};r.forEach(v=>{v.querySelectorAll(".page-footer").forEach(w=>{w.setAttribute("data-print-date",d)}),v.querySelectorAll(".sub-page-sheet .page-footer").forEach(w=>{w.setAttribute("data-print-date",d)})}),e.addEventListener("click",()=>{L().catch(v=>console.error("Offline export failed",v))});const y=()=>l==null?void 0:l.setAttribute("hidden","true");window.addEventListener("afterprint",N)}function Re(u){if(!u)return"‚Äì";const a=new Date(u);return Number.isNaN(a.getTime())?u:a.toLocaleDateString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit"})}function je(u){const{body:a,userSettings:r}=u,m=(a.dataset.repoUrl||r.repoUrl||"").trim()||"https://github.com/Seren200018/Vorlesung-Skript-Template",t=document.querySelector("[data-build-target='repo']");t&&(t.textContent=m,t.href!==void 0&&(t.href=m));const e=document.querySelector("[data-build-target='date']");e&&(e.textContent=Re(De(a,r)));const n=document.querySelector("[data-build-target='author']");n&&(n.textContent=(a.dataset.author||r.author||"Autor / Dozent").trim());const p=document.querySelector("[data-build-target='version']");p&&(p.textContent=(a.dataset.packageVersion||r.version||"unbekannt").trim());const b=document.querySelector("[data-build-target='copyright']");if(b){const o=(a.dataset.license||r.license||"CC BY-NC 4.0").trim();b.textContent=o,ze(b,o)}}function ze(u,a){var t;if(!u)return;(t=u.querySelector(".cc-badges"))==null||t.remove();const r=He(a);if(!r.length)return;const m=document.createElement("span");m.className="cc-badges",r.forEach(e=>{const n=document.createElement("span");n.className="cc-badge",n.title=`Creative Commons ${e}`,n.innerHTML=Fe(e),m.appendChild(n)}),u.appendChild(m)}function He(u){const a=(u||"").toUpperCase(),r=[];return a.includes("CC")&&(r.push("CC"),["BY","SA","ND","NC"].forEach(t=>{a.includes(t)&&r.push(t)}),(a.includes("0")||a.includes("ZERO"))&&r.push("0")),r}function Fe(u){const a=(u||"").toUpperCase(),r='<circle cx="10" cy="10" r="9" fill="currentColor" opacity="0.15" stroke="currentColor" stroke-width="1.1"/>';return a==="CC"?`<svg viewBox="0 0 20 20" aria-hidden="true" focusable="false">${r}<text x="10" y="13" text-anchor="middle" font-size="8" font-weight="700" fill="currentColor">CC</text></svg>`:a==="BY"?`<svg viewBox="0 0 20 20" aria-hidden="true" focusable="false">${r}<circle cx="10" cy="8" r="2.4" fill="currentColor"/><rect x="7" y="11" width="6" height="4.6" rx="1" fill="currentColor"/></svg>`:a==="NC"?`<svg viewBox="0 0 20 20" aria-hidden="true" focusable="false">${r}<text x="10" y="9.5" text-anchor="middle" font-size="6.5" font-weight="700" fill="currentColor">$</text><line x1="6" y1="6" x2="14" y2="14" stroke="currentColor" stroke-width="1.4"/></svg>`:a==="SA"?`<svg viewBox="0 0 20 20" aria-hidden="true" focusable="false">${r}<path d="M12.2 6.4 15 8l-2.8 1.6V8.9c-2.5 0-4.4 1.2-4.4 4.2 0-3 1.9-5.1 4.4-5.1V6.4Z" fill="currentColor"/></svg>`:a==="ND"?`<svg viewBox="0 0 20 20" aria-hidden="true" focusable="false">${r}<rect x="5" y="8" width="10" height="1.6" rx="0.5" fill="currentColor"/><rect x="5" y="11" width="10" height="1.6" rx="0.5" fill="currentColor"/></svg>`:a==="0"?`<svg viewBox="0 0 20 20" aria-hidden="true" focusable="false">${r}<text x="10" y="13" text-anchor="middle" font-size="9" font-weight="700" fill="currentColor">0</text></svg>`:`<svg viewBox="0 0 20 20" aria-hidden="true" focusable="false">${r}<text x="10" y="13" text-anchor="middle" font-size="8" font-weight="700" fill="currentColor">${a}</text></svg>`}function De(u,a){const r=[u.dataset.gitLastMod,u.dataset.repoModified,a.gitLastMod,document.lastModified].filter(Boolean).map(p=>p.toString().trim()).filter(Boolean).map(p=>new Date(p)).filter(p=>!Number.isNaN(p.getTime())),t=Date.now()+1e3*60*60*24,e=r.filter(p=>p.getTime()<=t);return e.length?e.reduce((p,b)=>p.getTime()>b.getTime()?p:b).toISOString():""}function ye(){const u=document.getElementById("literature-list"),a=Array.from(document.querySelectorAll(".doi-citation"));if(!u)return;const r=new Map,m=(t,e,n)=>{const p=t||"Autor",b=e||"o.J.",o=n?`, ${n}`:"";return`(${p} ${b}${o})`};if(a.forEach((t,e)=>{const n=(t.dataset.author||"").trim(),p=(t.dataset.year||"").trim(),b=(t.dataset.pages||"").trim(),o=(t.dataset.title||"").trim(),l=(t.dataset.journal||"").trim(),c=(t.dataset.doi||"").trim(),d=(t.dataset.url||"").trim(),g=c?`https://doi.org/${c}`:d,f=document.createElement(g?"a":"span");f.textContent=m(n,p,b),g&&(f.href=g,f.target="_blank",f.rel="noreferrer noopener"),t.innerHTML="",t.appendChild(f);const x=c||`${n}-${p}-${o}`||`entry-${e}`;r.has(x)||r.set(x,{author:n||"o. Autor",year:p||"o.J.",pages:b,title:o,journal:l,doi:c,link:g})}),u.innerHTML="",!r.size){const t=document.createElement("li");t.textContent="(keine Eintr√§ge markiert)",u.appendChild(t);return}r.forEach(t=>{const e=document.createElement("li");e.className="literature-item";const n=[];(t.author||t.year)&&n.push(`${t.author} (${t.year})`),t.title&&n.push(t.title),t.journal&&n.push(t.journal),t.pages&&n.push(t.pages);const p=n.filter(Boolean).join(". ");if(t.link){const b=document.createElement("span");b.textContent=p||"Quelle";const o=document.createElement("a");o.href=t.link,o.textContent=t.doi?`DOI: ${t.doi}`:t.link,o.target="_blank",o.rel="noreferrer noopener",e.append(b),e.append(" ‚Äì "),e.append(o)}else e.textContent=p||"Quelle";u.appendChild(e)})}function Ve(){const u=document.documentElement;if(!document.getElementById("zoom-controls"))return;const r=document.getElementById("subsheet-panel"),m=document.getElementById("subsheet-zoom"),t=document.getElementById("subsheet-content"),e=document.getElementById("zoom-in"),n=document.getElementById("zoom-out"),p=document.getElementById("zoom-reset");if(!e||!n||!p)return;const b="sheetZoomScale",o=.5,l=2,c=.1,d=y=>Math.min(l,Math.max(o,y)),g=y=>Math.round(y*10)/10;let f=1;const x=parseFloat(localStorage.getItem(b));Number.isFinite(x)&&(f=d(x));let N=(r==null?void 0:r.getBoundingClientRect().width)||0;const I=()=>{p.textContent=`${Math.round(f*100)}%`},_=()=>{if(!m||!t)return;m.style.width=`${f*100}%`,t.style.width=`${100/f}%`;const y=t.scrollHeight;y&&(m.style.height=`${y*f}px`)},z=()=>{u.style.setProperty("--sheet-scale",String(f)),N>0&&u.style.setProperty("--panel-width",`${Math.round(N*f)}px`),_(),localStorage.setItem(b,String(f)),I()};let D=null;window.addEventListener("resize",()=>{r&&(D||(D=requestAnimationFrame(()=>{D=null;const y=r.getBoundingClientRect().width;N=f?y/f:y,z()})))});let L=null;t&&m&&new MutationObserver(()=>{L||(L=requestAnimationFrame(()=>{L=null,_()}))}).observe(t,{childList:!0,subtree:!0}),e.addEventListener("click",()=>{f=d(g(f+c)),z()}),n.addEventListener("click",()=>{f=d(g(f-c)),z()}),p.addEventListener("click",()=>{f=1,z()}),z()}function ce(u){return((u==null?void 0:u.textContent)||"").replace(/\s+/g," ").trim()}function Oe(u){const a=u.querySelector("[data-title-author]")||u.querySelector(".Titlepage.Author")||u.querySelector(".titlepage-author")||u.querySelector("#titlepage-author"),r=ce(a);if(r)return r;const m=u.querySelector(".abstract")||u,e=Array.from(m.querySelectorAll("p, h1, h2, h3, div, span")).filter(n=>!(n.closest(".Titlepage.Series, .Titlepage.Title, .Titlepage.Subtitle")||n.matches(".Titlepage.Series, .Titlepage.Title, .Titlepage.Subtitle")));for(let n=e.length-1;n>=0;n-=1){const p=ce(e[n]);if(p)return p}return""}function Je(u){const{body:a}=u,r=document.querySelector(".sheet.Titlepage")||document.querySelector(".Titlepage");if(!r)return;const m=ce(r.querySelector("[data-title-series]")||r.querySelector(".Titlepage.Series")),t=ce(r.querySelector("[data-title-main]")||r.querySelector(".Titlepage.Title")),e=ce(r.querySelector("[data-title-subtitle]")||r.querySelector(".Titlepage.Subtitle")),n=Oe(r);t&&(a.dataset.lectureTitle=t),m&&(a.dataset.lectureSeries=m),e&&(a.dataset.lectureSubtitle=e),n&&(a.dataset.author=n),u.lectureTitle=a.dataset.lectureTitle||u.lectureTitle,u.lectureChapter=a.dataset.lectureChapter||u.lectureChapter}function Ue(u={}){const a=we(u),r=ve(a),m=Ce(a),t=Me(a,{ensureJSZip:m.ensureJSZip}),e=qe(a),n=$e(a);return window.addEventListener("scroll",e.requestAudioUpdate,{passive:!0}),window.addEventListener("resize",e.requestAudioUpdate),F("numberSubpages",()=>Le(a)),F("syncMetadataFromTitlePage",()=>Je(a)),F("initSubsheetPanel",()=>xe({typeset:r.typeset,requestAudioUpdate:e.requestAudioUpdate})),F("buildTocAndPageChrome",()=>Ae(a)),F("buildSymbolColumns",()=>Ie(a,r.typeset)),F("buildAssetLists",()=>ke(a)),F("populateBuildInfo",()=>je(a)),F("initAudioControls",()=>{e.initAudioControls(),e.bindVolumeControl()}),F("initVideos",()=>n.initVideos()),F("buildVideoList",()=>n.buildVideoList()),F("buildLiteratureIndex",()=>ye()),F("initPythonDemos",_e),F("initThemeSwitch",()=>Be(a)),F("initZoomControls",()=>Ve()),F("initPrintDialog",()=>Pe(a,{ensureJSZip:m.ensureJSZip})),F("initSheetNotes",()=>t.initSheetNotes()),F("initNoteExport",()=>t.initNoteExport()),F("initNoteImport",()=>t.initNoteImport()),F("initHighlightContextMenu",()=>t.initHighlightContextMenu()),window.addEventListener("load",()=>{F("initVideos (load)",()=>n.initVideos()),F("buildVideoList (load)",()=>n.buildVideoList()),F("buildLiteratureIndex (load)",()=>ye()),F("renderSheetAudio (load)",()=>e.renderSheetAudio())}),{context:a,math:r,zip:m,audio:e,videos:n,notes:t}}window.addEventListener("DOMContentLoaded",()=>{Ue();const u=document.getElementById("sketch-template-demo"),a=document.getElementById("msd-sketch"),r=document.getElementById("msd-anchor-demo"),m=document.getElementById("jsx-graph-demo"),t=u||a?he(()=>import("./rough-template-Cx6s0Y75.js"),__vite__mapDeps([0,1]),import.meta.url):null;u&&(t==null||t.then(({renderRoughTemplate:e})=>{e(u,{width:450,height:300,title:"Rough.js Skizze",subtitle:"Anpassbare Vorlage"})})),a&&(t==null||t.then(({renderMassSpringDamper:e})=>{e(a,{width:450,height:180,massLabel:"m",springLabel:"k",damperLabel:"c",forceLabel:"F(t)"})})),r&&he(async()=>{const{initMassSpringDamperAnchorsDemo:e}=await import("./msd-anchors-demo-BT70O9_B.js");return{initMassSpringDamperAnchorsDemo:e}},__vite__mapDeps([2,1,3,4]),import.meta.url).then(({initMassSpringDamperAnchorsDemo:e})=>{e(r,{bodeTargetId:"MSD_Anchor_middle_Div",controlsTargetId:"MSD_Anchor_rightmost_Div"})}),m&&he(async()=>{const{initJsxGraphDemo:e}=await import("./jsx-graph-demo-BQIG2cPR.js");return{initJsxGraphDemo:e}},[],import.meta.url).then(({initJsxGraphDemo:e})=>{e("jsx-graph-demo")})});
